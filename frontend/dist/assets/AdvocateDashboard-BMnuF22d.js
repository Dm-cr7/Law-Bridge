import{c as C,b as re,u as oe,r as d,l as ne,j as e,U as z,F as v,a as ie,m as f,f as ce}from"./index-f8gYbhCl.js";import{n as k}from"./index-BggV2thh.js";import{a as h}from"./api-BYptnXG6.js";import{N as le}from"./NewCaseModal-BAp23sC2.js";import{C as de,T as xe}from"./TaskFormModal-BhNMa0Fn.js";import{C as L}from"./circle-check-big-C9dl78oh.js";import{C as O}from"./calendar-days-DTHvXfWa.js";import{C as me}from"./chart-no-axes-column-increasing-CFON9vbY.js";import{R as I,P as he,a as ge,C as pe,T as N,X as E,Y as F,L as ue}from"./PieChart-BHf6O0Tn.js";import{B as je,a as fe}from"./BarChart-CZeVbNpz.js";import{C as K}from"./CartesianGrid-B7X0XMzY.js";import{L as be,a as ye}from"./LineChart-Gw1HkRV_.js";import"./axiosInstance-CMvw4fUn.js";import"./circle-x-BbSJhb8Y.js";import"./folder-kanban-1iVGXt7K.js";import"./cloud-upload-DCES_0jE.js";import"./index-Dgkh_OCz.js";/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],ke=C("chart-pie",ve);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ce=C("wifi-off",Ne);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Re=C("wifi",we),b={blue:{bg:"bg-blue-500",hover:"hover:bg-blue-600",text:"text-blue-600",border:"border-blue-500"},emerald:{bg:"bg-emerald-500",hover:"hover:bg-emerald-600",text:"text-emerald-600",border:"border-emerald-500"},green:{bg:"bg-green-500",hover:"hover:bg-green-600",text:"text-green-600",border:"border-green-500"},amber:{bg:"bg-amber-500",hover:"hover:bg-amber-600",text:"text-amber-600",border:"border-amber-500"},indigo:{bg:"bg-indigo-500",hover:"hover:bg-indigo-600",text:"text-indigo-600",border:"border-indigo-500"},gray:{bg:"bg-gray-700",hover:"hover:bg-gray-800",text:"text-gray-700",border:"border-gray-700"},purple:{bg:"bg-purple-500",hover:"hover:bg-purple-600",text:"text-purple-600",border:"border-purple-500"}};function Je(){const{user:r}=re(),a=oe(),[c,n]=d.useState([]),[o,p]=d.useState([]),[U,w]=d.useState([]),[m,R]=d.useState({successRate:0,history:[]}),[H,G]=d.useState([]),[W,M]=d.useState(!1),[J,A]=d.useState(!1),[y,S]=d.useState(!0),[D,T]=d.useState(!1);d.useEffect(()=>{r&&r.role?.toLowerCase()!=="advocate"&&a("/unauthorized")},[r,a]);const u=d.useCallback(async()=>{try{S(!0);const i={Authorization:`Bearer ${localStorage.getItem("token")}`},[t,l,x,te,ae]=await Promise.all([h.get("/api/cases?mine=true",{headers:i}),h.get("/api/tasks?assignedTo=self",{headers:i}),h.get("/api/notifications?limit=5",{headers:i}),h.get("/api/reports/adr/success",{headers:i}).catch(()=>({data:{data:{successRate:0,history:[]}}})),h.get("/api/hearings/calendar",{headers:i}).catch(()=>({data:{events:[]}}))]);n(t.data?.data||[]),p(l.data?.data||[]),w(x.data?.data||[]),R(te.data?.data||{successRate:0,history:[]}),G(ae.data?.events||[])}catch(s){console.error("Error fetching dashboard data:",s),k.error("Failed to load dashboard data")}finally{S(!1)}},[]);d.useEffect(()=>{if(!r?._id)return;const s=ne("http://localhost:5000",{transports:["websocket"],withCredentials:!0,query:{userId:r._id}});s.on("connect",()=>{T(!0),s.emit("joinRoom",r._id)}),s.on("disconnect",()=>T(!1)),s.on("case:new",t=>n(l=>[t,...l])),s.on("case:update",t=>n(l=>l.map(x=>x._id===t._id?t:x))),s.on("task:new",t=>p(l=>[t,...l])),s.on("task:update",t=>p(l=>l.map(x=>x._id===t._id?t:x))),s.on("notification:new",t=>w(l=>[t,...l].slice(0,10))),s.on("adr:updated",t=>R(t)),u();const i=setInterval(u,6e4);return()=>{clearInterval(i),s.disconnect()}},[r,u]);const X=c.length,_=o.length,$=o.filter(s=>s.status==="completed").length,Y=_-$,q=H.filter(s=>new Date(s.start)>new Date).length,V=d.useMemo(()=>{const s={open:0,progress:0,closed:0,other:0};return c.forEach(i=>{const t=(i.status||"").toLowerCase();t.includes("open")?s.open++:t.includes("progress")?s.progress++:t.includes("close")?s.closed++:s.other++}),[{name:"Open",value:s.open,color:"#2563eb"},{name:"In Progress",value:s.progress,color:"#10b981"},{name:"Closed",value:s.closed,color:"#16a34a"},{name:"Other",value:s.other,color:"#f59e0b"}]},[c]),Q=d.useMemo(()=>{const s={};return o.forEach(i=>{const t=i.status||"pending";s[t]=(s[t]||0)+1}),Object.entries(s).map(([i,t])=>({status:i,count:t}))},[o]),Z=d.useMemo(()=>{if(Array.isArray(m.history)&&m.history.length)return m.history.map(t=>({month:t.month,rate:t.rate}));const s=Math.round(m.successRate||0);return["May","Jun","Jul","Aug","Sep","Oct"].map((t,l)=>({month:t,rate:Math.max(0,Math.min(100,s+(l-3)*2))}))},[m]),ee=async()=>{try{const s=localStorage.getItem("token"),i=await h.get("/api/reports/export?type=cases&format=csv",{responseType:"blob",headers:{Authorization:`Bearer ${s}`}}),t=new Blob([i.data],{type:"text/csv;charset=utf-8;"}),l=window.URL.createObjectURL(t),x=document.createElement("a");x.href=l,x.download=`case_report_${r?.name||"advocate"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(x),x.click(),x.remove(),k.success("Report downloaded successfully!")}catch(s){console.error("Report error:",s),k.error("Failed to generate report")}},se=()=>e.jsx("div",{className:"bg-gray-200 animate-pulse rounded-xl h-24 w-full"});return e.jsxs("div",{className:"p-6 bg-gradient-to-br from-gray-50 via-blue-50 to-white min-h-screen text-gray-900",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between mb-6 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-semibold text-gray-800",children:["Welcome, ",r?.name||"Advocate"]}),e.jsx("div",{className:`flex items-center text-sm mt-1 ${D?"text-green-600":"text-red-500"}`,children:D?e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:14,className:"mr-1"})," Live updates active"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{size:14,className:"mr-1"})," Offline — syncing paused"]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(g,{onClick:()=>a("/dashboard/clients"),color:"amber",icon:e.jsx(z,{size:18}),text:"Register Client"}),e.jsx(g,{onClick:()=>a("/dashboard/documents/new"),color:"purple",icon:e.jsx(v,{size:18}),text:"Draft Document"}),e.jsx(g,{onClick:()=>M(!0),color:"blue",icon:e.jsx(de,{size:18}),text:"New Case"}),e.jsx(g,{onClick:()=>A(!0),color:"emerald",icon:e.jsx(L,{size:18}),text:"New Task"}),e.jsx(g,{onClick:()=>a("/dashboard/hearings"),color:"amber",icon:e.jsx(O,{size:18}),text:"View Calendar"}),e.jsx(g,{onClick:ee,color:"gray",icon:e.jsx(v,{size:18}),text:"Generate Report"})]})]}),e.jsx("div",{className:"grid lg:grid-cols-5 sm:grid-cols-2 gap-4 mb-6",children:y?Array.from({length:5}).map((s,i)=>e.jsx(se,{},i)):e.jsxs(e.Fragment,{children:[e.jsx(j,{icon:e.jsx(ie,{}),label:"Total Cases",value:X,color:"blue"}),e.jsx(j,{icon:e.jsx(z,{}),label:"Tasks Assigned",value:_,color:"emerald"}),e.jsx(j,{icon:e.jsx(L,{}),label:"Completed Tasks",value:$,color:"green"}),e.jsx(j,{icon:e.jsx(v,{}),label:"Pending Tasks",value:Y,color:"amber"}),e.jsx(j,{icon:e.jsx(O,{}),label:"Upcoming Hearings",value:q,color:"indigo"})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 mb-6",children:[e.jsx(P,{title:"Case Distribution",icon:e.jsx(ke,{size:18}),type:"pie",data:V}),e.jsx(P,{title:"Tasks by Status",icon:e.jsx(me,{size:18}),type:"bar",data:Q}),e.jsx(Me,{adrStats:m,adrHistory:Z})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx(B,{title:"Recent Cases",loading:y,items:c,type:"case"}),e.jsx(B,{title:"Recent Tasks",loading:y,items:o,type:"task"}),e.jsx(Ae,{notifications:U})]}),e.jsx(le,{isOpen:W,onClose:()=>M(!1),onSuccess:u}),e.jsx(xe,{isOpen:J,onClose:()=>A(!1),onSuccess:u})]})}const g=({onClick:r,color:a,icon:c,text:n})=>{const o=b[a]||b.gray;return e.jsxs("button",{onClick:r,className:`${o.bg} ${o.hover} text-white px-4 py-2 rounded-lg shadow-sm flex items-center gap-2 transition`,children:[c," ",n]})},j=({icon:r,label:a,value:c,color:n})=>{const o=b[n]||b.blue;return e.jsx(f.div,{className:`bg-white shadow-sm rounded-xl p-4 border-l-4 ${o.border}`,whileHover:{scale:1.02},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`${o.text} text-xl`,children:r}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-sm",children:a}),e.jsx("div",{className:"text-xl font-semibold text-gray-900",children:c})]})]})})},P=({title:r,icon:a,type:c,data:n})=>e.jsxs("div",{className:"bg-white shadow-md rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a,e.jsx("h3",{className:"text-lg font-semibold",children:r})]}),e.jsx("div",{style:{height:220},children:e.jsx(I,{children:c==="pie"?e.jsxs(he,{children:[e.jsx(ge,{data:n,dataKey:"value",nameKey:"name",outerRadius:70,innerRadius:36,paddingAngle:3,children:n.map(o=>e.jsx(pe,{fill:o.color},o.name))}),e.jsx(N,{})]}):e.jsxs(je,{data:n,children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(E,{dataKey:"status"}),e.jsx(F,{}),e.jsx(N,{}),e.jsx(fe,{dataKey:"count",fill:"#2563eb"})]})})})]}),Me=({adrStats:r,adrHistory:a})=>e.jsxs("div",{className:"bg-white shadow-md rounded-xl p-5 flex flex-col justify-between",children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("h3",{className:"text-lg font-semibold",children:"ADR Performance"})}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(Se,{percent:Math.round(r.successRate||0),size:96,strokeWidth:10}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Success Rate"}),e.jsxs("div",{className:"text-2xl font-semibold",children:[Math.round(r.successRate||0),"%"]}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Resolved via ADR vs total ADR cases"})]})]}),e.jsx("div",{className:"mt-4",style:{height:120},children:e.jsx(I,{children:e.jsxs(be,{data:a,children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(E,{dataKey:"month"}),e.jsx(F,{domain:[0,100]}),e.jsx(N,{}),e.jsx(ue,{}),e.jsx(ye,{type:"monotone",dataKey:"rate",stroke:"#10b981",strokeWidth:2,activeDot:{r:4}})]})})})]}),B=({title:r,loading:a,items:c,type:n})=>e.jsxs(f.div,{className:"bg-white shadow-md rounded-xl p-5",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:r}),a?e.jsx("div",{className:"text-gray-500 text-sm",children:"Loading..."}):c.length?e.jsx("ul",{className:"divide-y divide-gray-100",children:c.slice(0,6).map(o=>e.jsxs(f.li,{className:"py-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:o.title}),e.jsx("div",{className:"text-sm text-gray-600",children:n==="case"?`${o.clientName||"Unnamed Client"} — ${o.status||"unknown"}`:`Status: ${o.status||"pending"}`})]},o._id))}):e.jsxs("div",{className:"text-gray-400 text-sm",children:["No ",n,"s available"]})]}),Ae=({notifications:r})=>e.jsxs(f.div,{className:"bg-white shadow-md rounded-xl p-5",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ce,{size:20,className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Recent Notifications"})]}),r.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No notifications yet."}):e.jsx("ul",{className:"divide-y divide-gray-100",children:r.slice(0,8).map(a=>e.jsxs("li",{className:"py-2",children:[e.jsx("div",{className:"text-sm text-gray-700",children:a.message}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(a.createdAt).toLocaleString()})]},a._id))})]}),Se=({percent:r=0,size:a=80,strokeWidth:c=8})=>{const n=(a-c)/2,o=2*Math.PI*n,p=o-r/100*o;return e.jsxs("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"gradA",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#34d399"}),e.jsx("stop",{offset:"100%",stopColor:"#059669"})]})}),e.jsxs("g",{transform:`translate(${a/2}, ${a/2})`,children:[e.jsx("circle",{r:n,fill:"transparent",stroke:"#e6e7ee",strokeWidth:c}),e.jsx("circle",{r:n,fill:"transparent",stroke:"url(#gradA)",strokeWidth:c,strokeLinecap:"round",strokeDasharray:`${o} ${o}`,strokeDashoffset:p,transform:"rotate(-90)"}),e.jsxs("text",{x:"0",y:"4",textAnchor:"middle",fontSize:"14",fontWeight:"700",fill:"#0f172a",children:[r,"%"]})]})]})};export{Je as default};
