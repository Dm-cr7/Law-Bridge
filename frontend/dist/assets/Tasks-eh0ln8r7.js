import{c as S,r as o,o as L,s as n,j as e,d as $,A as B,m as z,U,C as E}from"./index-f8gYbhCl.js";import{t as h}from"./index-Cne2OvF7.js";import{a as D}from"./api-BYptnXG6.js";import{z as j}from"./index-BggV2thh.js";import{C as O,T as F}from"./TaskFormModal-BhNMa0Fn.js";import{C as _}from"./clock-CKoIW5G7.js";import{C as M}from"./circle-check-C-3y49rp.js";import{T as q}from"./trash-2-C5huwlW0.js";import{C as G}from"./circle-check-big-C9dl78oh.js";import{T as P}from"./triangle-alert-BTqnxZkX.js";import{U as W}from"./user-CmGx6MMi.js";import"./index-Dgkh_OCz.js";import"./circle-x-BbSJhb8Y.js";import"./calendar-days-DTHvXfWa.js";import"./cloud-upload-DCES_0jE.js";/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],R=S("circle-alert",H);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],K=S("layout-grid",J);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],V=S("pen-line",Q);function X({caseId:r}){const[p,m]=o.useState([]),[N,y]=o.useState(!0),[b,f]=o.useState(null),[k,a]=o.useState(!1);o.useEffect(()=>{const s=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");s&&L(s);const i=d=>{(!r||d.case===r)&&(m(C=>[d,...C]),j.success(`ðŸ†• New task: ${d.title}`))},g=d=>{(!r||d.case===r)&&(m(C=>C.map(w=>w._id===d._id?d:w)),j.info(`âœï¸ Task updated: ${d.title}`))},v=d=>{(!r||d.case===r)&&(m(C=>C.map(w=>w._id===d._id?{...w,status:"completed"}:w)),j.success(`âœ… Task completed: ${d.title}`))},T=({_id:d})=>{m(C=>C.filter(w=>w._id!==d)),j.warning("ðŸ—‘ï¸ Task removed")};return n.on("task:new",i),n.on("task:update",g),n.on("task:completed",v),n.on("task:deleted",T),()=>{n.off("task:new",i),n.off("task:update",g),n.off("task:completed",v),n.off("task:deleted",T)}},[r]);const t=o.useCallback(async()=>{try{y(!0);const s=await D.get(r?`/tasks?caseId=${r}`:"/tasks");m(s.data||[])}catch(s){console.error("âŒ Error fetching tasks:",s),j.error("Failed to load tasks")}finally{y(!1)}},[r]);o.useEffect(()=>{t()},[t]);const x=async s=>{if(confirm("Are you sure you want to delete this task?"))try{await D.delete(`/tasks/${s}`),j.success("Task deleted"),m(i=>i.filter(g=>g._id!==s))}catch(i){console.error("âŒ Error deleting task:",i),j.error("Failed to delete task")}},c=async s=>{if(s.status==="completed"){j("Task already completed");return}try{await D.patch(`/tasks/${s._id}/complete`),j.success("Task marked completed")}catch(i){console.error("âŒ Failed to complete task:",i),j.error("Failed to update status")}},l=s=>{f(s),a(!0)},u=()=>{f(null),a(!0)};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:r?"Case Tasks":"My Tasks"}),e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition",children:[e.jsx(O,{size:16})," New Task"]})]}),N?e.jsxs("div",{className:"flex items-center justify-center py-6 text-gray-500",children:[e.jsx($,{size:20,className:"animate-spin mr-2"}),"Loading tasks..."]}):p.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-6",children:"No tasks added yet."}):e.jsx("div",{className:"space-y-3",children:e.jsx(B,{children:p.map(s=>{const i=s.status!=="completed"&&s.dueDate&&new Date(s.dueDate)<new Date;return e.jsxs(z.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`border rounded-lg p-4 flex justify-between items-start transition-all ${s.status==="completed"?"bg-green-50 border-green-300":i?"bg-red-50 border-red-300":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("h3",{className:`font-medium ${s.status==="completed"?"line-through text-gray-500":"text-gray-800"}`,children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-gray-500",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full font-medium ${s.priority==="urgent"?"bg-red-100 text-red-700":s.priority==="high"?"bg-orange-100 text-orange-700":s.priority==="medium"?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:s.priority?.toUpperCase()}),s.dueDate&&e.jsxs("span",{className:"flex items-center gap-1 bg-blue-50 px-2 py-0.5 rounded-full text-blue-700",children:[e.jsx(_,{size:12})," ",new Date(s.dueDate).toLocaleDateString()]}),i&&e.jsxs("span",{className:"flex items-center gap-1 bg-red-100 px-2 py-0.5 rounded-full text-red-700",children:[e.jsx(R,{size:12})," Overdue"]})]}),s.assignedTo?.length>0&&e.jsxs("p",{className:"text-xs text-gray-600 mt-2 flex items-center gap-1",children:[e.jsx(U,{size:12}),s.assignedTo.map(g=>g.name?g.name:"User").join(", ")]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[s.status!=="completed"&&e.jsxs("button",{onClick:()=>c(s),className:"text-sm flex items-center gap-1 text-green-700 hover:text-green-800",children:[e.jsx(M,{size:16}),"Mark Done"]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{onClick:()=>l(s),className:"text-blue-600 hover:text-blue-800",title:"Edit task",children:e.jsx(V,{size:18})}),e.jsx("button",{onClick:()=>x(s._id),className:"text-red-600 hover:text-red-800",title:"Delete task",children:e.jsx(q,{size:18})})]})]})]},s._id)})})}),e.jsx(F,{isOpen:k,onClose:()=>a(!1),existingTask:b,caseId:r,onSuccess:t})]})}function Y({clientId:r}){const[p,m]=o.useState([]),[N,y]=o.useState(!0),b=o.useCallback(async()=>{if(r)try{y(!0);const{data:a}=await D.get(`/tasks?clientId=${r}`);m(Array.isArray(a)?a:[])}catch(a){console.error("âŒ Error fetching client tasks:",a),h.error("Failed to load client tasks")}finally{y(!1)}},[r]);o.useEffect(()=>{b();const a=c=>{(c?.client?._id===r||c?.client===r)&&(m(l=>[c,...l]),h.success(`ðŸ“‹ New task assigned: ${c.title}`))},t=c=>{(c?.client?._id===r||c?.client===r)&&(m(l=>l.map(u=>u._id===c._id?c:u)),h.info(`âœï¸ Task updated: ${c.title}`))},x=({_id:c})=>{m(l=>l.filter(u=>u._id!==c)),h.warning("ðŸ—‘ï¸ A task was removed")};return n.on("task:new",a),n.on("task:update",t),n.on("task:deleted",x),()=>{n.off("task:new",a),n.off("task:update",t),n.off("task:deleted",x)}},[r,b]);const f=a=>{const t="px-2 py-1 rounded-full text-xs font-medium capitalize inline-flex items-center gap-1";switch(a){case"completed":return`${t} bg-green-100 text-green-700`;case"in-progress":return`${t} bg-blue-100 text-blue-700`;case"pending":return`${t} bg-yellow-100 text-yellow-700`;case"overdue":return`${t} bg-red-100 text-red-700`;default:return`${t} bg-gray-100 text-gray-600`}},k=a=>a?new Date(a).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"â€”";return N?e.jsxs("div",{className:"flex justify-center items-center py-10 text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin mr-2"}),"Loading client tasks..."]}):p.length?e.jsx("div",{className:"space-y-3",children:p.map(a=>{const t=a.status!=="completed"&&a.dueDate&&new Date(a.dueDate)<new Date;return e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 bg-white shadow-sm hover:shadow-md hover:border-blue-300 transition-all duration-200",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm sm:text-base",children:a.title}),a.description&&e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:a.description})]}),e.jsxs("span",{className:f(a.status),children:[a.status,a.status==="completed"&&e.jsx(G,{className:"w-3 h-3"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:[e.jsx(_,{className:"inline w-3 h-3 mr-1"}),"Due: ",k(a.dueDate)]}),e.jsxs("span",{children:["Priority: ",a.priority||"medium"]}),e.jsxs("span",{children:["Assigned To:"," ",Array.isArray(a.assignedTo)?a.assignedTo.map(x=>x.name||"User").join(", "):a.assignedTo?.name||"Unassigned"]})]}),t&&e.jsxs("div",{className:"mt-2 text-xs flex items-center text-red-600",children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"Overdue"]})]},a._id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-gray-500",children:[e.jsx(E,{className:"w-8 h-8 mb-2 opacity-70"}),e.jsx("p",{children:"No tasks yet for this client."})]})}function A({clientId:r}){const[p,m]=o.useState([]),[N,y]=o.useState(!0),b=o.useCallback(async()=>{if(r)try{y(!0);const{data:t}=await D.get(`/tasks?clientId=${r}`);m(Array.isArray(t)?t:[])}catch(t){console.error("âŒ Error fetching client tasks:",t),h.error("Failed to load client tasks")}finally{y(!1)}},[r]);o.useEffect(()=>{b();const t=l=>{(l?.client===r||l?.client?._id===r)&&(m(u=>[l,...u]),h.success(`ðŸ“‹ New task assigned: ${l.title}`))},x=l=>{(l?.client===r||l?.client?._id===r)&&(m(u=>u.map(s=>s._id===l._id?l:s)),h.info(`âœï¸ Task updated: ${l.title}`))},c=({_id:l})=>{m(u=>u.filter(s=>s._id!==l)),h.warning("ðŸ—‘ï¸ A task was removed")};return n.on("task:new",t),n.on("task:update",x),n.on("task:deleted",c),()=>{n.off("task:new",t),n.off("task:update",x),n.off("task:deleted",c)}},[r,b]);const f={pending:p.filter(t=>t.status==="pending"),"in-progress":p.filter(t=>t.status==="in-progress"),completed:p.filter(t=>t.status==="completed"),overdue:p.filter(t=>t.status!=="completed"&&t.dueDate&&new Date(t.dueDate)<new Date)},k=[{id:"pending",title:"ðŸ•’ Pending",color:"border-amber-300"},{id:"in-progress",title:"âš™ï¸ In Progress",color:"border-blue-300"},{id:"overdue",title:"â° Overdue",color:"border-red-300"},{id:"completed",title:"âœ… Completed",color:"border-green-300"}],a=({task:t})=>{const x=t.dueDate?new Date(t.dueDate).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"â€”",c=t.status!=="completed"&&t.dueDate&&new Date(t.dueDate)<new Date;return e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm border hover:shadow-md hover:border-blue-300 transition",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:t.title}),t.description&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2",children:t.description}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:[e.jsx(_,{className:"inline w-3 h-3 mr-1"}),x]}),t.status==="completed"?e.jsx(M,{className:"w-4 h-4 text-green-600"}):c?e.jsx(P,{className:"w-4 h-4 text-red-500"}):e.jsx(_,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:[t.priority&&e.jsxs("span",{className:`px-2 py-0.5 rounded-full font-medium ${t.priority==="urgent"?"bg-red-100 text-red-700":t.priority==="high"?"bg-orange-100 text-orange-700":t.priority==="medium"?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:[t.priority.toUpperCase()," Priority"]}),Array.isArray(t.assignedTo)&&t.assignedTo.length>0&&e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(W,{size:12})," ",t.assignedTo.map(l=>l.name||"User").join(", ")]})]})]})};return N?e.jsxs("div",{className:"flex justify-center items-center py-10 text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin mr-2"}),"Loading tasks..."]}):p.length?e.jsx("div",{className:"grid md:grid-cols-4 gap-4",children:k.map(t=>e.jsxs("div",{className:`p-4 border rounded-lg bg-gray-50 ${t.color}`,children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:t.title}),e.jsx("div",{className:"space-y-3",children:f[t.id].length?f[t.id].map(x=>e.jsx(a,{task:x},x._id)):e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No tasks"})})]},t.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-gray-500",children:[e.jsx(R,{className:"w-8 h-8 mb-2 opacity-70"}),e.jsx("p",{children:"No tasks available for this client yet."})]})}function ue(){const[r,p]=o.useState("myTasks"),[m,N]=o.useState(!1),[y,b]=o.useState([]),[f,k]=o.useState(""),[a,t]=o.useState(null),[x,c]=o.useState(!0),l=o.useRef(!1),u=o.useCallback(async()=>{if(!l.current){l.current=!0;try{c(!0);const[i,g]=await Promise.all([D.get("/auth/me"),D.get("/clients")]),v=i?.data?.user??i?.data??i?.data?.data??null,T=g?.data?.data??g?.data??[];t(v),b(T)}catch(i){console.error("âŒ Error fetching user/clients:",i),h.error("Failed to load user or client data")}finally{c(!1)}}},[]);o.useEffect(()=>{u()},[u]),o.useEffect(()=>{const i=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");if(!i)return;L(i);const g=d=>h.success(`ðŸ†• New Task: ${d.title}`),v=d=>h(`âœï¸ Task Updated: ${d.title}`),T=d=>h.warning(`ðŸ—‘ï¸ Task Removed: ${d?.title??"a deleted task"}`);return n.on("task:new",g),n.on("task:update",v),n.on("task:deleted",T),()=>{n.off("task:new",g),n.off("task:update",v),n.off("task:deleted",T)}},[]);const s=[{id:"myTasks",label:"My Tasks",icon:e.jsx(E,{size:16})},{id:"clientTasks",label:"Client Tasks",icon:e.jsx(U,{size:16})},{id:"board",label:"Task Board",icon:e.jsx(K,{size:16})}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Task Management"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Track, assign, and complete legal tasks efficiently."})]}),e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition",children:[e.jsx(O,{size:16}),"New Task"]})]}),e.jsx("div",{className:"flex space-x-2 mb-6 border-b border-gray-200",children:s.map(i=>e.jsxs("button",{onClick:()=>p(i.id),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-t-md transition-all ${r===i.id?"bg-blue-100 text-blue-700 border-b-2 border-blue-600":"text-gray-600 hover:bg-gray-100"}`,children:[i.icon,i.label]},i.id))}),e.jsxs(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.25},className:"bg-white rounded-xl p-4 shadow-sm border",children:[r==="myTasks"&&e.jsx("div",{children:e.jsx(X,{})}),r==="clientTasks"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Select Client:"}),e.jsxs("select",{value:f,onChange:i=>k(i.target.value),className:"border border-gray-300 rounded-lg px-3 py-1.5 text-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Choose..."}),y.map(i=>e.jsx("option",{value:i._id,children:i.name},i._id))]})]}),f?e.jsxs(e.Fragment,{children:[e.jsx(Y,{clientId:f}),e.jsx("div",{className:"mt-6",children:e.jsx(A,{clientId:f})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic mt-4",children:"Select a client to view their tasks."})]}),r==="board"&&e.jsx("div",{children:!a&&!x?e.jsx("p",{className:"text-gray-500",children:"Cannot show board until user is loaded."}):e.jsx(A,{clientId:a?._id||""})})]},r),e.jsx(F,{isOpen:m,onClose:()=>N(!1),onSuccess:()=>{h.success("âœ… Task saved successfully")}})]})}export{ue as default};
