import{b as M,r as c,d as w,t as f,j as e,M as B,U as D,e as P,X as $}from"./index-DX-5XR_r.js";import{u as A}from"./index.esm-BEqESI9Z.js";import{P as z}from"./plus-kOBQIic3.js";import{P as U,S as L,a as T}from"./square-CVXSJYX-.js";import{T as q}from"./trash-2-C-quUaQj.js";const j=({children:n,variant:s="primary",className:t="",...i})=>{const l={primary:"bg-blue-600 hover:bg-blue-700 text-white",secondary:"bg-gray-100 hover:bg-gray-200 text-black",danger:"bg-red-600 hover:bg-red-700 text-white"};return e.jsx("button",{...i,className:`px-4 py-2 rounded-md text-sm font-medium transition ${l[s]||l.primary} ${t}`,children:n})},_=({isOpen:n,onClose:s,title:t,children:i})=>n?e.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg w-full max-w-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t}),e.jsx("button",{onClick:s,className:"p-2 rounded hover:bg-gray-100",children:e.jsx($,{size:18})})]}),e.jsx("div",{className:"p-6",children:i})]})}):null,S=({label:n,name:s,register:t,type:i="text",error:l,required:d=!1,defaultValue:u})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:[n,d&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{...t?t(s):{},name:s,type:i,defaultValue:u,className:"w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),l&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l.message||l})]});function F(n){if(!n)return[];const s=n?.data??n;return Array.isArray(s)?s:Array.isArray(s?.data)?s.data:Array.isArray(s?.items)?s.items:Array.isArray(s?.clients)?s.clients:s?.client&&typeof s.client=="object"?[s.client]:s&&typeof s=="object"&&["_id","email","name","firstName","lastName"].some(i=>Object.prototype.hasOwnProperty.call(s,i))?[s]:[]}const I=({isOpen:n,onClose:s,onCreated:t})=>{const{register:i,handleSubmit:l,reset:d,formState:u}=A(),{isSubmitting:p}=u;c.useEffect(()=>{n||d()},[n,d]);const y=async h=>{try{const o=await w.post("/clients",h),m=o?.data?.client?o.data.client:o?.data??o,b=F(m)[0]||m;f.success(`Client ${b?.name||"(unnamed)"} created`),t(b),d(),s()}catch(o){console.error("Create client failed:",o),f.error(o?.response?.data?.message||"Failed to create client")}};return e.jsx(_,{isOpen:n,onClose:s,title:"Create New Client",children:e.jsxs("form",{onSubmit:l(y),className:"space-y-4",children:[e.jsx(S,{label:"Full name",name:"name",register:i,required:!0}),e.jsx(S,{label:"Email",name:"email",register:i,type:"email"}),e.jsx(S,{label:"Phone",name:"phone",register:i}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(j,{variant:"secondary",onClick:s,type:"button",children:"Cancel"}),e.jsx(j,{type:"submit",disabled:p,children:p?"Creating...":"Create Client"})]})]})})},K=({isOpen:n,onClose:s,client:t,onUpdated:i})=>{const{register:l,handleSubmit:d,reset:u,formState:p}=A({defaultValues:t||{}}),{isSubmitting:y}=p;if(c.useEffect(()=>{t&&u(t)},[t,u]),!t)return null;const h=async o=>{try{const m=await w.put(`/clients/${t._id}`,o),N=m?.data??m;i(N),f.success("Client updated"),s()}catch(m){console.error("Update client error:",m),f.error(m?.response?.data?.message||"Failed to update client")}};return e.jsx(_,{isOpen:n,onClose:s,title:"Edit Client",children:e.jsxs("form",{onSubmit:d(h),className:"space-y-4",children:[e.jsx(S,{label:"Full name",name:"name",register:l}),e.jsx(S,{label:"Email",name:"email",register:l,type:"email"}),e.jsx(S,{label:"Phone",name:"phone",register:l}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(j,{variant:"secondary",onClick:s,type:"button",children:"Cancel"}),e.jsx(j,{type:"submit",disabled:y,children:y?"Saving...":"Save Changes"})]})]})})},R=({isOpen:n,onClose:s,client:t,onDeleted:i})=>{if(!t)return null;const l=async()=>{try{await w.delete(`/clients/${t._id}`),f.success("Client deleted"),i(t._id),s()}catch(d){console.error("Delete client failed:",d),f.error(d?.response?.data?.message||"Failed to delete client")}};return e.jsxs(_,{isOpen:n,onClose:s,title:"Delete Client",children:[e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:t.name}),"? This action is reversible by admins."]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(j,{variant:"secondary",onClick:s,children:"Cancel"}),e.jsx(j,{variant:"danger",onClick:l,children:"Delete"})]})]})},O=({isOpen:n,onClose:s,client:t,onShared:i})=>{const[l,d]=c.useState([]),[u,p]=c.useState([]),[y,h]=c.useState(!1),[o,m]=c.useState(!1);c.useEffect(()=>{if(!n)return;let r=!0;return h(!0),w.get("/users").then(x=>{const C=x?.data??[];if(r){const k=C.filter(v=>v._id!==t?.createdBy?._id);d(k),p((t?.sharedWith||[]).map(v=>typeof v=="string"?v:v._id))}}).catch(x=>{console.error("Load users for sharing failed:",x),f.error("Failed to load users")}).finally(()=>r&&h(!1)),()=>r=!1},[n,t]);const N=r=>p(x=>x.includes(r)?x.filter(C=>C!==r):[...x,r]),b=async()=>{try{m(!0);const r=await w.patch(`/clients/${t._id}/share`,{userIds:u});f.success("Client shared"),i(r.data),s()}catch(r){console.error("Share failed:",r),f.error(r?.response?.data?.message||"Failed to share client")}finally{m(!1)}};return n?e.jsxs(_,{isOpen:n,onClose:s,title:`Share "${t?.name}"`,children:[y?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(P,{className:"animate-spin"})}):l.length===0?e.jsx("p",{children:"No other users available to share with."}):e.jsx("div",{className:"max-h-64 overflow-auto divide-y",children:l.map(r=>{const x=r._id,C=u.includes(x);return e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[r.role," â€¢ ",r.email]})]}),e.jsx("button",{onClick:()=>N(x),className:"p-2",children:C?e.jsx(L,{className:"text-blue-600"}):e.jsx(T,{})})]},x)})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(j,{variant:"secondary",onClick:s,children:"Cancel"}),e.jsx(j,{onClick:b,disabled:o,children:o?"Saving...":"Share"})]})]}):null};function J(){const{user:n}=M(),[s,t]=c.useState([]),[i,l]=c.useState(!0),[d,u]=c.useState(null),[p,y]=c.useState(!1),[h,o]=c.useState(null),[m,N]=c.useState(null),[b,r]=c.useState(null),x=c.useCallback(async()=>{l(!0),u(null);try{const a=await w.get("/clients"),g=F(a);t(g)}catch(a){console.error("Load clients error:",a),u(a?.response?.data?.message||"Failed to load clients"),f.error(a?.response?.data?.message||"Failed to load clients"),t([])}finally{l(!1)}},[]);c.useEffect(()=>{x()},[x]);const C=a=>t(g=>[a,...g]),k=a=>t(g=>g.map(E=>E._id===a._id?a:E)),v=a=>t(g=>g.filter(E=>E._id!==a));return e.jsxs("div",{className:"p-6 min-h-screen bg-slate-50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Client Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage clients, linked accounts and sharing."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(j,{onClick:()=>y(!0),className:"inline-flex items-center gap-2",children:[e.jsx(z,{size:14})," New Client"]}),e.jsx(j,{variant:"secondary",onClick:x,children:"Refresh"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow border overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-left",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4 font-medium",children:"Name"}),e.jsx("th",{className:"py-3 px-4 font-medium",children:"Email"}),e.jsx("th",{className:"py-3 px-4 font-medium",children:"Phone"}),e.jsx("th",{className:"py-3 px-4 font-medium",children:"Intaked By"}),e.jsx("th",{className:"py-3 px-4 text-right font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:i?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-gray-500",children:"Loading..."})}):d?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-red-500",children:d})}):s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-gray-500",children:"No clients found"})}):s.map(a=>{const g=a?.createdBy?typeof a.createdBy=="string"?a.createdBy:a.createdBy.name||a.createdBy.email:"-";return e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:a.name||`${a.firstName||""} ${a.lastName||""}`.trim()||"(Unnamed)"}),e.jsxs("td",{className:"py-3 px-4 flex items-center gap-2 text-gray-700",children:[e.jsx(B,{size:14})," ",a.email||"-"]}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:a.phone||a.primaryPhone||"-"}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:g}),e.jsxs("td",{className:"py-3 px-4 text-right space-x-3",children:[e.jsxs("button",{onClick:()=>r(a),className:"text-green-600 hover:underline inline-flex items-center gap-1",children:[e.jsx(D,{size:14})," Share"]}),e.jsxs("button",{onClick:()=>o(a),className:"text-blue-600 hover:underline inline-flex items-center gap-1",children:[e.jsx(U,{size:14})," Edit"]}),e.jsxs("button",{onClick:()=>N(a),className:"text-red-600 hover:underline inline-flex items-center gap-1",children:[e.jsx(q,{size:14})," Delete"]})]})]},a._id)})})]})}),e.jsx(I,{isOpen:p,onClose:()=>y(!1),onCreated:C}),h&&e.jsx(K,{isOpen:!!h,client:h,onClose:()=>o(null),onUpdated:k}),m&&e.jsx(R,{isOpen:!!m,client:m,onClose:()=>N(null),onDeleted:v}),b&&e.jsx(O,{isOpen:!!b,client:b,onClose:()=>r(null),onShared:a=>{k(a),r(null)}})]})}export{J as default};
