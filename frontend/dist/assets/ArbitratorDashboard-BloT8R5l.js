import{b as ae,r,d as h,t as l,l as ie,j as e,F as le,X as v}from"./index-DX-5XR_r.js";import{_ as re}from"./style-BVPaQRh9.js";import{u as _}from"./index.esm-BEqESI9Z.js";import{a as R,o as M,s as x,p as $,n as z}from"./schemas-CQTzvhsC.js";import{G as L}from"./gavel-C4t352ev.js";import{A as de}from"./archive-KlwNZkQ2.js";import{C as ne}from"./clock-BQTrMZWA.js";import{C as ce}from"./check-DiMJEtlw.js";import{C as oe}from"./cloud-upload-BqI6-c57.js";import{L as xe}from"./link-BIoVTXN6.js";import{D as I}from"./download-DmMTyFAX.js";const me="/socket.io",je="http://localhost:5000",ue=M({caseRef:x().min(3,"Case reference is required"),title:x().min(3,"Title required"),parties:x().min(3,"At least one party identifier required"),scheduledAt:x().min(1,"Date/time required"),durationMinutes:$(d=>Number(d),z().min(10)),locationOrUrl:x().optional().nullable(),notes:x().optional().nullable()}),he=M({decisionText:x().min(10,"Decision text is required"),awardAmount:$(d=>d===""?null:Number(d),z().nullable()),effectiveDate:x().optional().nullable()});function _e(){const{user:d}=ae()||{},[m,j]=r.useState([]),[y,A]=r.useState({}),[q,E]=r.useState(!0),[be,D]=r.useState(null),[O,b]=r.useState(!1),[P,p]=r.useState(!1),[o,f]=r.useState(null),[B,N]=r.useState(!1),[k,w]=r.useState(null),{register:u,handleSubmit:H,reset:K,formState:{errors:c,isSubmitting:T}}=_({resolver:R(ue)}),{register:C,handleSubmit:G,reset:J,formState:{errors:U,isSubmitting:F}}=_({resolver:R(he)}),g=r.useCallback(async()=>{E(!0);try{const s=await h.get("/arbitrations");j(Array.isArray(s.data)?s.data:[])}catch(s){console.error("Failed to load arbitrations:",s),l.error(s?.response?.data?.message||"Failed to load arbitrations")}finally{E(!1)}},[]);r.useEffect(()=>{g()},[g]),r.useEffect(()=>{if(!d||!d._id)return;const s=ie(je,{path:me,transports:["websocket"],withCredentials:!0,auth:{token:localStorage.getItem("token")},query:{userId:d._id,role:d.role}});return D(s),s.on("connect",()=>{console.info("Arbitrator socket connected:",s.id),s.emit("join",{room:`arbitrator:${d._id}`})}),s.on("arbitration:created",t=>{j(a=>[t,...a]),l.success(`New arbitration created: ${t.title}`)}),s.on("arbitration:updated",t=>{j(a=>a.map(i=>i._id===t._id?t:i)),l.success(`Arbitration updated: ${t.title}`)}),s.on("arbitration:decision",t=>{j(a=>a.map(i=>i._id===t._id?t:i)),l.success(`Decision issued for ${t.title}`)}),s.on("evidence:added",({arbitrationId:t,evidence:a})=>{A(i=>{const n=i[t]?[a,...i[t]]:[a];return{...i,[t]:n}}),l.success("New evidence added")}),s.on("notifications:new",t=>{l.info(t?.message||"New notification")}),s.on("disconnect",t=>{console.warn("Socket disconnected:",t)}),s.on("connect_error",t=>{console.error("Socket connect_error",t),l.error("Real-time connection error")}),()=>{s.removeAllListeners(),s.disconnect(),D(null)}},[d]);const X=async s=>{try{const{data:t}=await h.post("/arbitrations",s);j(a=>[t,...a]),l.success("Arbitration created"),K(),b(!1)}catch(t){throw console.error("Create arbitration failed:",t),l.error(t?.response?.data?.message||"Failed to create arbitration"),t}},Q=async s=>{try{const t=await h.get(`/arbitrations/${s}/evidence`);A(a=>({...a,[s]:Array.isArray(t.data)?t.data:[]}))}catch(t){console.error("Load evidence failed:",t),l.error("Failed to load evidence")}},V=async s=>{if(o)try{const t=new FormData;for(const n of s.files)t.append("files",n);s.notes&&t.append("notes",s.notes);const a=await h.post(`/arbitrations/${o}/evidence`,t,{headers:{"Content-Type":"multipart/form-data"}}),i=Array.isArray(a.data)?a.data:[a.data];A(n=>({...n,[o]:[...n[o]||[],...i]})),l.success("Evidence uploaded"),p(!1),f(null)}catch(t){throw console.error("Upload evidence error:",t),l.error(t?.response?.data?.message||"Failed to upload evidence"),t}},W=async s=>{if(k)try{const t={decisionText:s.decisionText,awardAmount:s.awardAmount||null,effectiveDate:s.effectiveDate||null},{data:a}=await h.post(`/arbitrations/${k}/award`,t);j(i=>i.map(n=>n._id===a._id?a:n)),l.success("Award issued"),J(),N(!1),w(null)}catch(t){throw console.error("Issue award failed:",t),l.error(t?.response?.data?.message||"Failed to issue award"),t}},Y=async s=>{try{const t=await h.get(`/reports/arbitrations/${s}/award`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),i=document.createElement("a");i.href=a,i.setAttribute("download",`award-${s}.pdf`),document.body.appendChild(i),i.click(),i.remove(),l.success("Award downloaded")}catch(t){console.error("Download award failed:",t),l.error("Failed to download award")}},Z=s=>{const t=s.locationOrUrl||s.virtualRoomUrl;if(!t){l.error("No hearing link available");return}window.open(t,"_blank")},S=r.useMemo(()=>{const s=m.length,t=m.filter(i=>i.status&&i.status.toLowerCase().includes("scheduled")).length,a=m.filter(i=>i.status&&i.status.toLowerCase().includes("decided")).length;return{total:s,scheduled:t,decided:a}},[m]);return e.jsxs("div",{className:"jsx-2116780755 arbitrator-dashboard min-h-screen p-6 bg-black-50",children:[e.jsxs("div",{className:"jsx-2116780755 flex items-start justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("h1",{className:"jsx-2116780755 text-3xl font-extrabold text-slate-900",children:"Arbitrator Dashboard"}),e.jsx("p",{className:"jsx-2116780755 text-slate-600 mt-1",children:"Manage arbitrations, evidence and awards â€” in real time."})]}),e.jsxs("div",{className:"jsx-2116780755 flex gap-3",children:[e.jsxs("button",{onClick:()=>b(!0),className:"jsx-2116780755 inline-flex items-center gap-2 px-4 py-2 rounded-md bg-blue-600 text-white",children:[e.jsx(L,{})," New Arbitration"]}),e.jsx("button",{onClick:g,className:"jsx-2116780755 inline-flex items-center gap-2 px-4 py-2 rounded-md bg-white border",children:"Refresh"})]})]}),e.jsxs("div",{className:"jsx-2116780755 grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"jsx-2116780755 bg-white p-4 rounded-lg shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"jsx-2116780755 p-2 bg-blue-50 rounded-md text-blue-600",children:e.jsx(de,{})}),e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("p",{className:"jsx-2116780755 text-sm text-slate-500",children:"Total Arbitrations"}),e.jsx("p",{className:"jsx-2116780755 text-2xl font-bold",children:S.total})]})]}),e.jsxs("div",{className:"jsx-2116780755 bg-white p-4 rounded-lg shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"jsx-2116780755 p-2 bg-amber-50 rounded-md text-amber-600",children:e.jsx(ne,{})}),e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("p",{className:"jsx-2116780755 text-sm text-slate-500",children:"Scheduled"}),e.jsx("p",{className:"jsx-2116780755 text-2xl font-bold",children:S.scheduled})]})]}),e.jsxs("div",{className:"jsx-2116780755 bg-white p-4 rounded-lg shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"jsx-2116780755 p-2 bg-green-50 rounded-md text-green-600",children:e.jsx(ce,{})}),e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("p",{className:"jsx-2116780755 text-sm text-slate-500",children:"Decisions"}),e.jsx("p",{className:"jsx-2116780755 text-2xl font-bold",children:S.decided})]})]})]}),e.jsxs("div",{className:"jsx-2116780755 grid lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"jsx-2116780755 lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"jsx-2116780755 bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"jsx-2116780755 flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"jsx-2116780755 text-lg font-semibold",children:"Arbitrations"}),e.jsxs("div",{className:"jsx-2116780755 text-sm text-slate-500",children:[m.length," total"]})]}),q?e.jsxs("div",{className:"jsx-2116780755 space-y-2 animate-pulse",children:[e.jsx("div",{className:"jsx-2116780755 h-8 bg-black-200 rounded"}),e.jsx("div",{className:"jsx-2116780755 h-8 bg-black-200 rounded"})]}):m.length===0?e.jsx("div",{className:"jsx-2116780755 text-slate-500",children:"No arbitrations found."}):e.jsx("ul",{className:"jsx-2116780755 space-y-2",children:m.map(s=>e.jsxs("li",{className:"jsx-2116780755 p-3 rounded-md bg-slate-50 flex items-start justify-between",children:[e.jsxs("div",{className:"jsx-2116780755",children:[e.jsxs("div",{className:"jsx-2116780755 font-semibold",children:[s.title," ",e.jsxs("span",{className:"jsx-2116780755 text-xs text-slate-500 ml-2",children:["#",s.caseRef]})]}),e.jsx("div",{className:"jsx-2116780755 text-xs text-slate-500",children:s.parties}),e.jsx("div",{className:"jsx-2116780755 text-xs text-slate-400 mt-1",children:s.scheduledAt?new Date(s.scheduledAt).toLocaleString():"Not scheduled"})]}),e.jsxs("div",{className:"jsx-2116780755 flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"jsx-2116780755 flex gap-2",children:[e.jsxs("button",{onClick:()=>{f(s._id),Q(s._id),p(!0)},className:"jsx-2116780755 px-2 py-1 bg-white border rounded text-xs",children:[e.jsx(oe,{size:14})," Evidence"]}),e.jsxs("button",{onClick:()=>{w(s._id),N(!0)},className:"jsx-2116780755 px-2 py-1 bg-white border rounded text-xs",children:[e.jsx(le,{size:14})," Award"]}),e.jsxs("button",{onClick:()=>Z(s),className:"jsx-2116780755 px-2 py-1 bg-blue-600 text-white rounded text-xs",children:[e.jsx(xe,{size:12})," Join"]})]}),e.jsxs("div",{className:"jsx-2116780755 flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>Y(s._id),title:"Download Award",className:"jsx-2116780755 text-xs text-slate-600",children:e.jsx(I,{size:14})}),e.jsx("button",{onClick:async()=>{if(confirm("Cancel this arbitration?"))try{await h.delete(`/arbitrations/${s._id}`),j(t=>t.filter(a=>a._id!==s._id)),l.success("Arbitration cancelled")}catch(t){console.error("Cancel arbitration failed:",t),l.error("Failed to cancel arbitration")}},className:"jsx-2116780755 text-xs text-red-600",children:e.jsx(v,{size:14})})]})]})]},s._id))})]}),e.jsxs("div",{className:"jsx-2116780755 bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"jsx-2116780755 font-semibold mb-2",children:"Evidence & Awards"}),e.jsx("p",{className:"jsx-2116780755 text-sm text-slate-500 mb-3",children:"Select an arbitration and upload evidence or draft awards. Evidence is stored per arbitration record."}),e.jsx("div",{className:"jsx-2116780755 text-sm text-slate-700",children:e.jsx("p",{className:"jsx-2116780755",children:"To view evidence: open an arbitration and click Evidence. Uploaded files will appear in the evidence list and push live updates to participants."})})]})]}),e.jsxs("aside",{className:"jsx-2116780755 space-y-4",children:[e.jsxs("div",{className:"jsx-2116780755 bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"jsx-2116780755 flex items-center justify-between mb-3",children:e.jsx("h4",{className:"jsx-2116780755 font-semibold",children:"Quick Actions"})}),e.jsxs("div",{className:"jsx-2116780755 flex flex-col gap-2",children:[e.jsxs("button",{onClick:()=>b(!0),className:"jsx-2116780755 px-3 py-2 rounded bg-blue-600 text-white flex items-center gap-2",children:[e.jsx(L,{})," New Arbitration"]}),e.jsx("button",{onClick:g,className:"jsx-2116780755 px-3 py-2 rounded bg-white border flex items-center gap-2",children:"Refresh List"})]})]}),e.jsxs("div",{className:"jsx-2116780755 bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("h4",{className:"jsx-2116780755 font-semibold mb-2",children:"Recent Notifications"}),e.jsx("div",{className:"jsx-2116780755 text-sm text-slate-500",children:"Notifications appear as they arrive. For persistent notifications, implement /notifications endpoint."})]}),e.jsxs("div",{className:"jsx-2116780755 bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("h4",{className:"jsx-2116780755 font-semibold mb-2",children:"Tips"}),e.jsxs("ul",{className:"jsx-2116780755 text-sm text-slate-600 list-disc pl-5",children:[e.jsx("li",{className:"jsx-2116780755",children:"Issue awards promptly to comply with timelines."}),e.jsx("li",{className:"jsx-2116780755",children:"Attach evidence to the correct arbitration record."}),e.jsx("li",{className:"jsx-2116780755",children:"Use virtual links for remote hearings; ensure links are saved in the arbitration record."})]})]})]})]}),O&&e.jsx("div",{className:"jsx-2116780755 fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"jsx-2116780755 bg-white rounded-lg shadow-lg w-full max-w-xl p-6",children:[e.jsxs("div",{className:"jsx-2116780755 flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"jsx-2116780755 text-lg font-semibold",children:"Create Arbitration"}),e.jsx("button",{onClick:()=>b(!1),className:"jsx-2116780755 p-2 rounded hover:bg-slate-100",children:e.jsx(v,{})})]}),e.jsxs("form",{onSubmit:H(X),className:"jsx-2116780755 space-y-4",children:[e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("label",{className:"jsx-2116780755 block text-sm font-medium",children:"Case reference"}),e.jsx("input",{...u("caseRef"),className:"jsx-2116780755 mt-1 w-full rounded-md border p-2"}),c.caseRef&&e.jsx("p",{className:"jsx-2116780755 text-xs text-red-600",children:c.caseRef.message})]}),e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("label",{className:"jsx-2116780755 block text-sm font-medium",children:"Title"}),e.jsx("input",{...u("title"),className:"jsx-2116780755 mt-1 w-full rounded-md border p-2"}),c.title&&e.jsx("p",{className:"jsx-2116780755 text-xs text-red-600",children:c.title.message})]}),e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("label",{className:"jsx-2116780755 block text-sm font-medium",children:"Parties (comma-separated identifiers)"}),e.jsx("input",{...u("parties"),placeholder:"Party A, Party B",className:"jsx-2116780755 mt-1 w-full rounded-md border p-2"}),c.parties&&e.jsx("p",{className:"jsx-2116780755 text-xs text-red-600",children:c.parties.message})]}),e.jsxs("div",{className:"jsx-2116780755 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("label",{className:"jsx-2116780755 block text-sm font-medium",children:"Date & Time"}),e.jsx("input",{...u("scheduledAt"),type:"datetime-local",className:"jsx-2116780755 mt-1 w-full rounded-md border p-2"}),c.scheduledAt&&e.jsx("p",{className:"jsx-2116780755 text-xs text-red-600",children:c.scheduledAt.message})]}),e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("label",{className:"jsx-2116780755 block text-sm font-medium",children:"Duration (minutes)"}),e.jsx("input",{...u("durationMinutes",{valueAsNumber:!0}),type:"number",min:10,className:"jsx-2116780755 mt-1 w-full rounded-md border p-2"}),c.durationMinutes&&e.jsx("p",{className:"jsx-2116780755 text-xs text-red-600",children:c.durationMinutes.message})]})]}),e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("label",{className:"jsx-2116780755 block text-sm font-medium",children:"Location / Virtual link (optional)"}),e.jsx("input",{...u("locationOrUrl"),className:"jsx-2116780755 mt-1 w-full rounded-md border p-2"})]}),e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("label",{className:"jsx-2116780755 block text-sm font-medium",children:"Notes"}),e.jsx("textarea",{...u("notes"),rows:3,className:"jsx-2116780755 mt-1 w-full rounded-md border p-2"})]}),e.jsxs("div",{className:"jsx-2116780755 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"jsx-2116780755 px-4 py-2 rounded bg-black-100",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:T,className:"jsx-2116780755 px-4 py-2 rounded bg-blue-600 text-white",children:T?"Creating...":"Create Arbitration"})]})]})]})}),P&&o&&e.jsx("div",{className:"jsx-2116780755 fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"jsx-2116780755 bg-white rounded-lg shadow-lg w-full max-w-lg p-6",children:[e.jsxs("div",{className:"jsx-2116780755 flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"jsx-2116780755 text-lg font-semibold",children:"Upload Evidence"}),e.jsx("button",{onClick:()=>{p(!1),f(null)},className:"jsx-2116780755 p-2 rounded hover:bg-slate-100",children:e.jsx(v,{})})]}),e.jsx(ee,{onSubmit:V,className:"jsx-2116780755"}),e.jsxs("div",{className:"jsx-2116780755 mt-4",children:[e.jsx("h4",{className:"jsx-2116780755 font-semibold mb-2",children:"Existing Evidence"}),e.jsx("div",{className:"jsx-2116780755 text-sm text-slate-600",children:Array.isArray(y[o])&&y[o].length?e.jsx("ul",{className:"jsx-2116780755 space-y-2 max-h-48 overflow-auto",children:y[o].map(s=>e.jsxs("li",{className:"jsx-2116780755 flex items-center justify-between bg-slate-50 p-2 rounded",children:[e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("div",{className:"jsx-2116780755 font-medium",children:s.filename||s.name}),e.jsx("div",{className:"jsx-2116780755 text-xs text-slate-500",children:s.notes||""})]}),e.jsx("div",{className:"jsx-2116780755 flex gap-2",children:e.jsx("a",{href:s.url||s.path,target:"_blank",rel:"noreferrer",className:"jsx-2116780755 text-slate-600",children:e.jsx(I,{size:14})})})]},s._id||s.filename))}):e.jsx("div",{className:"jsx-2116780755 text-slate-500",children:"No evidence uploaded yet."})})]})]})}),B&&k&&e.jsx("div",{className:"jsx-2116780755 fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"jsx-2116780755 bg-white rounded-lg shadow-lg w-full max-w-2xl p-6",children:[e.jsxs("div",{className:"jsx-2116780755 flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"jsx-2116780755 text-lg font-semibold",children:"Draft & Issue Award"}),e.jsx("button",{onClick:()=>{N(!1),w(null)},className:"jsx-2116780755 p-2 rounded hover:bg-slate-100",children:e.jsx(v,{})})]}),e.jsxs("form",{onSubmit:G(W),className:"jsx-2116780755 space-y-4",children:[e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("label",{className:"jsx-2116780755 block text-sm font-medium",children:"Decision / Award Text"}),e.jsx("textarea",{...C("decisionText"),rows:6,className:"jsx-2116780755 mt-1 w-full rounded-md border p-2"}),U.decisionText&&e.jsx("p",{className:"jsx-2116780755 text-xs text-red-600",children:U.decisionText.message})]}),e.jsxs("div",{className:"jsx-2116780755 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("label",{className:"jsx-2116780755 block text-sm font-medium",children:"Award Amount (optional)"}),e.jsx("input",{...C("awardAmount"),type:"number",className:"jsx-2116780755 mt-1 w-full rounded-md border p-2"})]}),e.jsxs("div",{className:"jsx-2116780755",children:[e.jsx("label",{className:"jsx-2116780755 block text-sm font-medium",children:"Effective Date (optional)"}),e.jsx("input",{...C("effectiveDate"),type:"date",className:"jsx-2116780755 mt-1 w-full rounded-md border p-2"})]})]}),e.jsxs("div",{className:"jsx-2116780755 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{N(!1),w(null)},className:"jsx-2116780755 px-4 py-2 rounded bg-black-100",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:F,className:"jsx-2116780755 px-4 py-2 rounded bg-green-600 text-white",children:F?"Issuing...":"Issue Award"})]})]})]})}),e.jsx(re,{id:"2116780755",children:['.arbitrator-dashboard.jsx-2116780755{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}']})]});function ee({onSubmit:s}){const{register:t,handleSubmit:a,reset:i,formState:{isSubmitting:n}}=_(),se=async te=>{await s(te),i()};return e.jsxs("form",{onSubmit:a(se),className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Files"}),e.jsx("input",{...t("files"),type:"file",multiple:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Notes (optional)"}),e.jsx("input",{...t("notes"),className:"mt-1 w-full rounded-md border p-2"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{p(!1),f(null)},className:"px-3 py-2 rounded bg-black-100",children:"Close"}),e.jsx("button",{type:"submit",disabled:n,className:"px-3 py-2 rounded bg-blue-600 text-white",children:"Upload"})]})]})}}export{_e as default};
