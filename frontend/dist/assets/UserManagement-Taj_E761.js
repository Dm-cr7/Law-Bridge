import{c as J,b as xe,r,l as pe,j as e,U as he,m as fe,X as be}from"./index-f8gYbhCl.js";import{a as u}from"./api-BYptnXG6.js";import{t as c}from"./index-Cne2OvF7.js";import{u as je}from"./index.esm-CD2Rk9NM.js";import{a as ge,o as ve,c as we,s as O,_ as Ne}from"./schemas-B-PNgsin.js";import{P as ye}from"./plus-BsD4batw.js";import{R as ke}from"./refresh-ccw-ClALOjYv.js";import{D as K}from"./download-prd_qkFN.js";import{T as H}from"./trash-2-C5huwlW0.js";import{C as X}from"./check-kVNLxjHv.js";import{L as Se}from"./lock-CswVYtIB.js";import"./index-Dgkh_OCz.js";/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ae=J("pen",Ce);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Re=J("search",_e),Ue="/socket.io",Ee="http://localhost:5000",G=[{value:"advocate",label:"Advocate"},{value:"paralegal",label:"Paralegal"},{value:"arbitrator",label:"Arbitrator"},{value:"reconciliator",label:"Reconciliator"},{value:"admin",label:"Admin"},{value:"client",label:"Client"}],ze=ve({name:O().min(2,"Name is required"),email:O().email("Enter a valid email"),role:Ne(["advocate","paralegal","arbitrator","reconciliator","admin","client"]),password:O().min(6).optional(),active:we().optional()});function Ke(){const{user:y}=xe(),D=r.useRef(null),[d,x]=r.useState([]),[Q,T]=r.useState(!0),[B,R]=r.useState(0),[k,W]=r.useState(""),[S,Y]=r.useState(""),[C,Z]=r.useState(""),[U,I]=r.useState("createdAt:desc"),[j,h]=r.useState(1),[A,ee]=r.useState(20),[i,f]=r.useState(new Set),[M,E]=r.useState(!1),[se,g]=r.useState(!1),[n,v]=r.useState(null),[q,_]=r.useState(!1),z=r.useRef(d);r.useEffect(()=>{z.current=d},[d]),r.useEffect(()=>{if(!y)return;const s=pe(Ee,{path:Ue,transports:["websocket"],withCredentials:!0,auth:{token:localStorage.getItem("token")},query:{userId:y._id,role:y.role}});return D.current=s,s.on("connect",()=>console.info("Admin socket connected",s.id)),s.on("user:created",t=>{x(a=>[t,...a]),R(a=>a+1),c.success(`User created: ${t.name}`)}),s.on("user:updated",t=>{x(a=>a.map(l=>l._id===t._id?t:l)),c.success(`User updated: ${t.name}`)}),s.on("user:statusChanged",({id:t,active:a})=>{x(l=>l.map(o=>o._id===t?{...o,active:a}:o)),c.success(`User ${a?"activated":"deactivated"}`)}),s.on("disconnect",()=>console.warn("Admin socket disconnected")),()=>{s.removeAllListeners(),s.disconnect(),D.current=null}},[y]);const b=r.useCallback(async()=>{T(!0);try{const s={search:k||void 0,role:S||void 0,status:C||void 0,page:j,limit:A,sort:U},a=(await u.get("/users",{params:s})).data;x(Array.isArray(a.data)?a.data:a),R(a.total??(Array.isArray(a.data)?a.data.length:0)),f(new Set),E(!1)}catch(s){console.error("Failed to load users",s),c.error("Failed to load users")}finally{T(!1)}},[k,S,C,j,A,U]);r.useEffect(()=>{b()},[b]);const $=Math.max(1,Math.ceil(B/A)),te=s=>{f(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},ae=()=>{if(M){f(new Set),E(!1);return}const s=d.map(t=>t._id);f(new Set(s)),E(!0)},{register:w,handleSubmit:re,reset:L,formState:{errors:m}}=je({resolver:ge(ze),defaultValues:{name:"",email:"",role:"paralegal",password:"",active:!0}});r.useEffect(()=>{L(n?{name:n.name,email:n.email,role:n.role,password:"",active:n.active??!0}:{name:"",email:"",role:"paralegal",password:"",active:!0})},[n,L]);const le=async s=>{_(!0);try{const t={...s};t.password||delete t.password;const a=await u.post("/users",t);x(l=>[a.data,...l]),R(l=>l+1),g(!1),c.success("User created")}catch(t){console.error("Create failed",t),c.error(t?.response?.data?.message||"Failed to create user")}finally{_(!1)}},ce=async s=>{if(n){_(!0);try{const t={name:s.name,email:s.email,role:s.role,active:s.active};s.password&&(t.password=s.password);const a=await u.put(`/users/${n._id}`,t);x(l=>l.map(o=>o._id===a.data._id?a.data:o)),v(null),c.success("User updated")}catch(t){console.error("Update failed",t),c.error(t?.response?.data?.message||"Failed to update user")}finally{_(!1)}}},ne=async s=>{const t=s.active?`Deactivate ${s.name}?`:`Reactivate ${s.name}?`;if(window.confirm(t))try{await u.put(`/users/${s._id}/status`,{active:!s.active}),x(a=>a.map(l=>l._id===s._1d?{...l,active:!l.active}:l)),b()}catch(a){console.error("Toggle status failed",a),c.error("Failed to change user status")}},ie=async()=>{if(i.size===0)return c.warning("No users selected");if(window.confirm(`Deactivate ${i.size} users?`))try{const s=Array.from(i);await u.put("/users/bulk/status",{ids:s,active:!1}),c.success("Users deactivated"),b()}catch(s){console.error("Bulk deactivate failed",s),c.error("Bulk deactivation failed")}},oe=async()=>{if(i.size===0)return c.warning("No users selected");if(window.confirm(`Reactivate ${i.size} users?`))try{const s=Array.from(i);await u.put("/users/bulk/status",{ids:s,active:!0}),c.success("Users reactivated"),b()}catch(s){console.error("Bulk reactivate failed",s),c.error("Bulk reactivation failed")}},de=()=>{if(i.size===0)return c.warning("No users selected");const s=z.current.filter(a=>i.has(a._id)),t=V(s);P(t,"users-export.csv","text/csv")},me=async s=>{if(window.confirm(`Send password reset for ${s.email}?`))try{await u.post(`/users/${s._id}/reset-password`),c.success("Password reset requested (email sent)")}catch(t){console.error("Reset password failed",t),c.error("Failed to request password reset")}},ue=async()=>{try{const s=await u.get("/users/export",{params:{search:k,role:S,status:C},responseType:"blob"});if(s.data){const t=`users-export-${new Date().toISOString().slice(0,10)}.csv`;P(s.data,t,"text/csv");return}}catch{const t=V(z.current);P(t,`users-export-${new Date().toISOString().slice(0,10)}.csv`,"text/csv")}};function P(s,t,a="text/plain"){const l=s instanceof Blob?s:new Blob([s],{type:a}),o=URL.createObjectURL(l),p=document.createElement("a");p.href=o,p.download=t,document.body.appendChild(p),p.click(),p.remove(),URL.revokeObjectURL(o)}function V(s){if(!Array.isArray(s)||s.length===0)return"";const t=["_id","name","email","role","active","createdAt"],a=[t.join(",")];for(const l of s){const o=t.map(p=>{let N=l[p]??"";return N===!0&&(N="true"),N===!1&&(N="false"),`"${String(N).replace(/"/g,'""')}"`});a.push(o.join(","))}return a.join(`
`)}const F=s=>{const[t,a]=U.split(":");I(t===s?`${s}:${a==="desc"?"asc":"desc"}`:`${s}:desc`)};return e.jsx("div",{className:"min-h-screen p-6 bg-black-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded text-blue-600",children:e.jsx(he,{size:26})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Create, edit, and manage platform users in real time."})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{g(!0),v(null)},className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded",children:[e.jsx(ye,{size:16})," Create user"]}),e.jsxs("button",{onClick:b,className:"inline-flex items-center gap-2 px-3 py-2 bg-white border rounded",children:[e.jsx(ke,{size:16})," Refresh"]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-1/2",children:[e.jsx(Re,{}),e.jsx("input",{"aria-label":"Search users",placeholder:"Search by name, email...",value:k,onChange:s=>{W(s.target.value),h(1)},className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:S,onChange:s=>{Y(s.target.value),h(1)},className:"border rounded px-2 py-2",children:[e.jsx("option",{value:"",children:"All roles"}),G.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("select",{value:C,onChange:s=>{Z(s.target.value),h(1)},className:"border rounded px-2 py-2",children:[e.jsx("option",{value:"",children:"All status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsxs("select",{value:A,onChange:s=>{ee(Number(s.target.value)),h(1)},className:"border rounded px-2 py-2",children:[e.jsx("option",{value:10,children:"10 / page"}),e.jsx("option",{value:20,children:"20 / page"}),e.jsx("option",{value:50,children:"50 / page"})]}),e.jsxs("button",{onClick:ue,title:"Export current list (server-side if available)",className:"px-3 py-2 bg-white border rounded inline-flex items-center gap-2",children:[e.jsx(K,{size:16})," Export"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:ae}),e.jsx("span",{className:"text-sm",children:"Select all on page"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:ie,className:"px-3 py-2 bg-red-600 text-white rounded inline-flex items-center gap-2",children:[e.jsx(H,{size:14})," Deactivate"]}),e.jsxs("button",{onClick:oe,className:"px-3 py-2 bg-green-600 text-white rounded inline-flex items-center gap-2",children:[e.jsx(X,{size:14})," Reactivate"]}),e.jsxs("button",{onClick:de,className:"px-3 py-2 bg-white border rounded inline-flex items-center gap-2",children:[e.jsx(K,{size:14})," Export CSV"]})]})]}),e.jsxs("div",{className:"text-sm text-slate-500",children:[B," users"]})]}),e.jsx("div",{className:"bg-white rounded shadow overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:e.jsx("input",{type:"checkbox",checked:i.size===d.length&&d.length>0,onChange:()=>{i.size===d.length?f(new Set):f(new Set(d.map(s=>s._id)))}})}),e.jsx("th",{className:"p-2 text-left cursor-pointer",onClick:()=>F("name"),children:"Name"}),e.jsx("th",{className:"p-2 text-left cursor-pointer",onClick:()=>F("email"),children:"Email"}),e.jsx("th",{className:"p-2 text-left",children:"Role"}),e.jsx("th",{className:"p-2 text-left cursor-pointer",onClick:()=>F("createdAt"),children:"Created"}),e.jsx("th",{className:"p-2 text-left",children:"Status"}),e.jsx("th",{className:"p-2 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:Q?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-6 text-center",children:"Loading users..."})}):d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-6 text-center",children:"No users found"})}):d.map(s=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-slate-50",children:[e.jsx("td",{className:"p-2",children:e.jsx("input",{checked:i.has(s._id),onChange:()=>te(s._id),type:"checkbox"})}),e.jsxs("td",{className:"p-2",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-slate-500",children:s.email})]}),e.jsx("td",{className:"p-2",children:s.email}),e.jsx("td",{className:"p-2",children:s.role}),e.jsx("td",{className:"p-2",children:new Date(s.createdAt).toLocaleString()}),e.jsx("td",{className:"p-2",children:s.active?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded text-xs",children:"Active"}):e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded text-xs",children:"Inactive"})}),e.jsx("td",{className:"p-2 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{title:"Edit",onClick:()=>{v(s),g(!0)},className:"px-2 py-1 bg-white border rounded inline-flex items-center gap-1",children:e.jsx(Ae,{size:14})}),e.jsx("button",{title:"Reset password",onClick:()=>me(s),className:"px-2 py-1 bg-white border rounded inline-flex items-center gap-1",children:e.jsx(Se,{size:14})}),e.jsx("button",{title:s.active?"Deactivate":"Reactivate",onClick:()=>ne(s),className:`px-2 py-1 rounded inline-flex items-center gap-1 ${s.active?"bg-red-600 text-white":"bg-green-600 text-white"}`,children:s.active?e.jsx(H,{size:14}):e.jsx(X,{size:14})})]})})]},s._id))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:["Page ",j," of ",$]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:j<=1,onClick:()=>h(s=>Math.max(1,s-1)),className:"px-3 py-1 border rounded",children:"Prev"}),e.jsx("button",{disabled:j>=$,onClick:()=>h(s=>Math.min($,s+1)),className:"px-3 py-1 border rounded",children:"Next"})]})]}),se&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs(fe.div,{initial:{scale:.98,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg shadow-lg w-full max-w-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:n?"Edit user":"Create user"}),e.jsx("button",{onClick:()=>{g(!1),v(null)},className:"p-2 rounded hover:bg-slate-100",children:e.jsx(be,{})})]}),e.jsxs("form",{onSubmit:re(n?ce:le),className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Full name"}),e.jsx("input",{...w("name"),className:"w-full border rounded px-3 py-2"}),m.name&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:m.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),e.jsx("input",{...w("email"),className:"w-full border rounded px-3 py-2"}),m.email&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:m.email.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),e.jsx("select",{...w("role"),className:"w-full border rounded px-3 py-2",children:G.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),m.role&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:m.role.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Active"}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",...w("active")}),e.jsx("span",{className:"text-sm",children:"Active"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:n?"Reset password (optional)":"Password"}),e.jsx("input",{...w("password"),type:"password",placeholder:n?"Leave blank to keep current password":"",className:"w-full border rounded px-3 py-2"}),m.password&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:m.password.message})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),v(null)},className:"px-4 py-2 rounded bg-black-100",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:q,className:"px-4 py-2 rounded bg-blue-600 text-white",children:q?"Saving...":n?"Save changes":"Create"})]})]})]})})]})})}export{Ke as default};
