import{b as R,r as d,d as p,t as i,l as U,j as e,X as F,g as I,F as $,U as M}from"./index-DX-5XR_r.js";import{_ as z}from"./style-BVPaQRh9.js";import{u as B}from"./index.esm-BEqESI9Z.js";import{a as O,o as K,s as g}from"./schemas-CQTzvhsC.js";import{P as V}from"./plus-kOBQIic3.js";const q="/socket.io",H="http://localhost:5000",J=K({name:g().min(2,"Name must be at least 2 characters"),email:g().email("Enter a valid email"),phone:g().optional().nullable(),notes:g().optional().nullable()});function ee(){const{user:j,token:S}=R()||{},o=S||localStorage.getItem("authToken")||localStorage.getItem("token"),[f,b]=d.useState([]),[c,x]=d.useState([]),[h,w]=d.useState(!0),[X,y]=d.useState(null),[P,u]=d.useState(!1),{register:N,handleSubmit:T,reset:D,formState:{errors:m,isSubmitting:k}}=B({resolver:O(J),defaultValues:{name:"",email:"",phone:"",notes:""}}),C=s=>s?Array.isArray(s)?s:Array.isArray(s.data)?s.data:Array.isArray(s.data?.data)?s.data.data:Array.isArray(s.data?.items)?s.data.items:[]:[];d.useEffect(()=>{try{console.info("ParalegalDashboard: API baseURL =",p?.defaults?.baseURL??"(no baseURL on API instance)")}catch{}},[]);const _=d.useCallback(async()=>{w(!0);try{const s=o?{Authorization:`Bearer ${o}`}:void 0,[a,t]=await Promise.all([p.get("/clients",{headers:s}),p.get("/tasks",{headers:s})]);b(C(a)),x(C(t))}catch(s){console.error("Paralegal dashboard load error:",s),i.error(s?.response?.data?.message||"Failed to load dashboard"),b([]),x([])}finally{w(!1)}},[o]);d.useEffect(()=>{_()},[_]),d.useEffect(()=>{if(!j||!j._id)return;const s=U(H,{path:q,transports:["websocket"],withCredentials:!0,auth:{token:o},query:{userId:j._id,role:j.role}});return y(s),s.on("connect",()=>{console.info("ParalegalDashboard: connected to socket",s.id)}),s.on("client:created",a=>{!a||!a._id||(b(t=>t.some(l=>l._id===a._id)?t:[a,...t]),i.success(`New client: ${a.name}`))}),s.on("task:created",a=>{!a||!a._id||(x(t=>t.some(l=>l._id===a._id)?t:[a,...t]),i.success(`Task assigned: ${a.title}`))}),s.on("task:updated",a=>{!a||!a._id||x(t=>t.map(l=>l._id===a._id?a:l))}),s.on("task:deleted",a=>{const t=a?.id||a?._id||a;t&&(x(l=>l.filter(r=>r._id!==t)),i.success("Task removed"))}),s.on("notifications:new",a=>{i.info(a?.message||"New notification")}),s.on("disconnect",a=>{console.warn("ParalegalDashboard: socket disconnected",a)}),s.on("connect_error",a=>{console.error("ParalegalDashboard: socket connect_error",a),i.error("Real-time connection error")}),()=>{try{s.removeAllListeners(),s.disconnect()}catch{}y(null)}},[j,o]);const v=d.useMemo(()=>{const s=Array.isArray(c)?c:[],a=s.filter(r=>{const n=(r.status||"").toLowerCase();return n.includes("to do")||n==="todo"||n==="open"||n==="pending"}).length,t=s.filter(r=>(r.status||"").toLowerCase().includes("progress")).length,l=s.filter(r=>{const n=(r.status||"").toLowerCase();return n.includes("complete")||n.includes("done")||n==="completed"}).length;return{todo:a,inProgress:t,done:l}},[c]),E=async s=>{try{const a=o?{Authorization:`Bearer ${o}`}:void 0,t=await p.post("/clients",s,{headers:a}),l=t.data?.client||t.data?.data||t.data||t;l?._id&&b(r=>r.some(n=>n._id===l._id)?r:[l,...r]),i.success("Client created"),D(),u(!1)}catch(a){throw console.error("Create client failed:",a),i.error(a?.response?.data?.message||"Failed to create client"),a}},L=async s=>{const a=c;x(t=>t.map(l=>l._id===s?{...l,status:"completed"}:l));try{const t=o?{Authorization:`Bearer ${o}`}:void 0,l=await p.put(`/tasks/${s}`,{status:"completed"},{headers:t}),r=l.data?.task||l.data||l;r?._id&&x(n=>n.map(A=>A._id===r._id?r:A)),i.success("Task marked completed")}catch(t){console.error("Mark task done failed:",t),i.error(t?.response?.data?.message||"Failed to update task"),x(a)}};return e.jsxs("div",{className:"jsx-2660935587 paralegal-dashboard min-h-screen p-6 bg-slate-50",children:[P&&e.jsx("div",{className:"jsx-2660935587 fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"jsx-2660935587 bg-white rounded-lg shadow-lg w-full max-w-md p-6",children:[e.jsxs("div",{className:"jsx-2660935587 flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"jsx-2660935587 text-lg font-semibold",children:"Create New Client"}),e.jsx("button",{onClick:()=>u(!1),"aria-label":"Close",className:"jsx-2660935587 p-1 rounded hover:bg-slate-100",children:e.jsx(F,{})})]}),e.jsxs("form",{onSubmit:T(E),noValidate:!0,className:"jsx-2660935587 space-y-4",children:[e.jsxs("div",{className:"jsx-2660935587",children:[e.jsx("label",{className:"jsx-2660935587 block text-sm font-medium",children:"Full name"}),e.jsx("input",{...N("name"),placeholder:"Jane Doe","aria-invalid":!!m.name,className:"jsx-2660935587 mt-1 w-full rounded-md border border-slate-200 shadow-sm p-2"}),m.name&&e.jsx("p",{className:"jsx-2660935587 text-xs text-red-600 mt-1",children:m.name.message})]}),e.jsxs("div",{className:"jsx-2660935587",children:[e.jsx("label",{className:"jsx-2660935587 block text-sm font-medium",children:"Email"}),e.jsx("input",{...N("email"),type:"email",placeholder:"client@example.com","aria-invalid":!!m.email,className:"jsx-2660935587 mt-1 w-full rounded-md border border-slate-200 shadow-sm p-2"}),m.email&&e.jsx("p",{className:"jsx-2660935587 text-xs text-red-600 mt-1",children:m.email.message})]}),e.jsxs("div",{className:"jsx-2660935587",children:[e.jsx("label",{className:"jsx-2660935587 block text-sm font-medium",children:"Phone"}),e.jsx("input",{...N("phone"),type:"tel",placeholder:"+2547...",className:"jsx-2660935587 mt-1 w-full rounded-md border border-slate-200 shadow-sm p-2"})]}),e.jsxs("div",{className:"jsx-2660935587",children:[e.jsx("label",{className:"jsx-2660935587 block text-sm font-medium",children:"Notes (optional)"}),e.jsx("textarea",{...N("notes"),rows:3,className:"jsx-2660935587 mt-1 w-full rounded-md border border-slate-200 shadow-sm p-2"})]}),e.jsxs("div",{className:"jsx-2660935587 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"jsx-2660935587 px-4 py-2 rounded-md bg-slate-100",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:k,className:"jsx-2660935587 px-4 py-2 rounded-md bg-blue-600 text-white",children:k?"Creating...":"Create Client"})]})]})]})}),e.jsxs("header",{className:"jsx-2660935587 flex items-start justify-between mb-6 gap-4",children:[e.jsxs("div",{className:"jsx-2660935587",children:[e.jsx("h1",{className:"jsx-2660935587 text-3xl font-extrabold text-slate-900",children:"Paralegal Dashboard"}),e.jsx("p",{className:"jsx-2660935587 text-slate-600 mt-1",children:"Client intake, tasks, and document prep — live."})]}),e.jsx("div",{className:"jsx-2660935587 flex items-center gap-3",children:e.jsxs("button",{onClick:()=>u(!0),className:"jsx-2660935587 inline-flex items-center gap-2 px-4 py-2 rounded-md bg-blue-600 text-white",children:[e.jsx(V,{size:16})," New Client"]})})]}),e.jsxs("div",{className:"jsx-2660935587 grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"jsx-2660935587 bg-white p-4 rounded-lg shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"jsx-2660935587 p-2 bg-blue-50 rounded-md text-blue-600",children:e.jsx(I,{})}),e.jsxs("div",{className:"jsx-2660935587",children:[e.jsx("p",{className:"jsx-2660935587 text-sm text-slate-500",children:"To Do"}),e.jsx("p",{className:"jsx-2660935587 text-2xl font-bold",children:h?"—":v.todo})]})]}),e.jsxs("div",{className:"jsx-2660935587 bg-white p-4 rounded-lg shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"jsx-2660935587 p-2 bg-amber-50 rounded-md text-amber-600",children:e.jsx($,{})}),e.jsxs("div",{className:"jsx-2660935587",children:[e.jsx("p",{className:"jsx-2660935587 text-sm text-slate-500",children:"In Progress"}),e.jsx("p",{className:"jsx-2660935587 text-2xl font-bold",children:h?"—":v.inProgress})]})]}),e.jsxs("div",{className:"jsx-2660935587 bg-white p-4 rounded-lg shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"jsx-2660935587 p-2 bg-green-50 rounded-md text-green-600",children:e.jsx(M,{})}),e.jsxs("div",{className:"jsx-2660935587",children:[e.jsx("p",{className:"jsx-2660935587 text-sm text-slate-500",children:"Completed"}),e.jsx("p",{className:"jsx-2660935587 text-2xl font-bold",children:h?"—":v.done})]})]})]}),e.jsxs("div",{className:"jsx-2660935587 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"jsx-2660935587 lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"jsx-2660935587 bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"jsx-2660935587 flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"jsx-2660935587 text-lg font-semibold",children:"All Tasks"}),e.jsx("div",{className:"jsx-2660935587 text-sm text-slate-500",children:Array.isArray(c)?c.length:0})]}),e.jsx("div",{className:"jsx-2660935587",children:h?e.jsxs("div",{className:"jsx-2660935587 animate-pulse space-y-2",children:[e.jsx("div",{className:"jsx-2660935587 h-8 bg-slate-200 rounded"}),e.jsx("div",{className:"jsx-2660935587 h-8 bg-slate-200 rounded"}),e.jsx("div",{className:"jsx-2660935587 h-8 bg-slate-200 rounded"})]}):!Array.isArray(c)||c.length===0?e.jsx("div",{className:"jsx-2660935587 text-center text-slate-500",children:"No tasks assigned"}):e.jsx("ul",{className:"jsx-2660935587 space-y-2",children:c.map(s=>e.jsxs("li",{className:"jsx-2660935587 flex items-center justify-between p-3 rounded bg-slate-50",children:[e.jsxs("div",{className:"jsx-2660935587",children:[e.jsx("div",{className:"jsx-2660935587 font-medium",children:s.title}),e.jsx("div",{className:"jsx-2660935587 text-xs text-slate-500",children:s.description})]}),e.jsxs("div",{className:"jsx-2660935587 flex items-center gap-3",children:[e.jsx("div",{className:`jsx-2660935587 px-2 py-1 text-xs rounded ${(s.status||"").toLowerCase().includes("progress")?"bg-amber-100":(s.status||"").toLowerCase().includes("done")?"bg-green-100":"bg-slate-100"}`,children:s.status||"Open"}),e.jsx("button",{onClick:()=>L(s._id),className:"jsx-2660935587 px-3 py-1 rounded bg-white border hover:shadow",children:"Mark Done"})]})]},s._id))})})]}),e.jsxs("div",{className:"jsx-2660935587 bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"jsx-2660935587 flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"jsx-2660935587 text-lg font-semibold",children:"Documents & Evidence"}),e.jsx("div",{className:"jsx-2660935587 text-sm text-slate-500",children:"Manage uploads & templates"})]}),e.jsxs("div",{className:"jsx-2660935587 text-slate-600",children:[e.jsx("p",{className:"jsx-2660935587 mb-2",children:"This section links to the document vault, template automation, and evidence uploader. Use the Documents area to draft templates requested by advocates and attach to cases."}),e.jsxs("div",{className:"jsx-2660935587 flex gap-3",children:[e.jsx("button",{className:"jsx-2660935587 px-3 py-2 rounded bg-blue-50 text-blue-700",children:"Open Document Vault"}),e.jsx("button",{className:"jsx-2660935587 px-3 py-2 rounded bg-slate-100",children:"Upload Evidence"})]})]})]})]}),e.jsxs("aside",{className:"jsx-2660935587 space-y-4",children:[e.jsxs("div",{className:"jsx-2660935587 bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"jsx-2660935587 flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"jsx-2660935587 font-semibold",children:"Clients"}),e.jsx("button",{onClick:()=>u(!0),className:"jsx-2660935587 text-sm text-blue-600",children:"+ New"})]}),e.jsx("div",{className:"jsx-2660935587",children:h?e.jsxs("div",{className:"jsx-2660935587 animate-pulse space-y-2",children:[e.jsx("div",{className:"jsx-2660935587 h-8 bg-slate-200 rounded"}),e.jsx("div",{className:"jsx-2660935587 h-8 bg-slate-200 rounded"})]}):!Array.isArray(f)||f.length===0?e.jsx("div",{className:"jsx-2660935587 text-slate-500",children:"No clients yet"}):e.jsx("ul",{className:"jsx-2660935587 space-y-2 max-h-72 overflow-auto",children:f.map(s=>e.jsxs("li",{className:"jsx-2660935587 flex items-center justify-between p-2 rounded hover:bg-slate-50",children:[e.jsxs("div",{className:"jsx-2660935587",children:[e.jsx("div",{className:"jsx-2660935587 font-medium",children:s.name}),e.jsx("div",{className:"jsx-2660935587 text-xs text-slate-500",children:s.email})]}),e.jsx("div",{className:"jsx-2660935587 text-xs text-slate-500",children:s.phone||"-"})]},s._id))})})]}),e.jsxs("div",{className:"jsx-2660935587 bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"jsx-2660935587 flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"jsx-2660935587 font-semibold",children:"Notifications"}),e.jsx("div",{className:"jsx-2660935587 text-sm text-slate-500",children:"Real-time"})]}),e.jsx("div",{className:"jsx-2660935587 space-y-2 max-h-48 overflow-auto text-slate-700",children:e.jsx("p",{className:"jsx-2660935587 text-sm text-slate-500",children:"New notifications appear as they arrive."})})]})]})]}),e.jsx(z,{id:"2660935587",children:['.paralegal-dashboard.jsx-2660935587{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}']})]})}export{ee as default};
