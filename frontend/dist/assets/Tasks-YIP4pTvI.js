import{r as o,v as _,s as n,d as D,j as e,e as S,A as R,m as L,U as z,t as f,g as U,c as B}from"./index-DX-5XR_r.js";import{z as b}from"./index-DFuZcw6R.js";import{T as E}from"./TaskFormModal-DzvgFc1i.js";import{C as O,a as F,P as G,L as W}from"./pen-line-B0KHk44y.js";import{C as A}from"./clock-BQTrMZWA.js";import{C as P}from"./circle-check-B3J-mFKz.js";import{T as q}from"./trash-2-C-quUaQj.js";import{C as H}from"./circle-check-big-CsO3dtKP.js";import{T as M}from"./triangle-alert-B4QflJIn.js";import"./circle-x-Dq1y862S.js";import"./cloud-upload-BqI6-c57.js";function J({caseId:r}){const[g,m]=o.useState([]),[w,j]=o.useState(!0),[N,h]=o.useState(null),[v,a]=o.useState(!1);o.useEffect(()=>{const s=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");s&&_(s);const i=c=>{(!r||c.case===r)&&(m(y=>[c,...Array.isArray(y)?y:[]]),b.success(`ðŸ†• New task: ${c.title}`))},p=c=>{(!r||c.case===r)&&(m(y=>Array.isArray(y)?y.map(T=>T._id===c._id?c:T):[c]),b.info(`âœï¸ Task updated: ${c.title}`))},k=c=>{(!r||c.case===r)&&(m(y=>Array.isArray(y)?y.map(T=>T._id===c._id?{...T,status:"completed"}:T):[]),b.success(`âœ… Task completed: ${c.title}`))},C=({_id:c})=>{m(y=>Array.isArray(y)?y.filter(T=>T._id!==c):[]),b.warning("ðŸ—‘ï¸ Task removed")};return n.on("task:new",i),n.on("task:updated",p),n.on("task:completed",k),n.on("task:deleted",C),()=>{n.off("task:new",i),n.off("task:updated",p),n.off("task:completed",k),n.off("task:deleted",C)}},[r]);const t=o.useCallback(async()=>{try{j(!0);const s=await D.get(r?`/tasks?caseId=${r}`:"/tasks"),i=Array.isArray(s.data)?s.data:Array.isArray(s.data?.data)?s.data.data:[];m(i)}catch(s){console.error("âŒ Error fetching tasks:",s),b.error("Failed to load tasks"),m([])}finally{j(!1)}},[r]);o.useEffect(()=>{t()},[t]);const x=async s=>{if(confirm("Are you sure you want to delete this task?"))try{await D.delete(`/tasks/${s}`),b.success("Task deleted"),m(i=>i.filter(p=>p._id!==s))}catch(i){console.error("âŒ Error deleting task:",i),b.error("Failed to delete task")}},d=async s=>{if(s.status==="completed"){b("Task already completed");return}try{await D.patch(`/tasks/${s._id}/complete`),b.success("Task marked completed")}catch(i){console.error("âŒ Failed to complete task:",i),b.error("Failed to update status")}},l=s=>{h(s),a(!0)},u=()=>{h(null),a(!0)};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:r?"Case Tasks":"My Tasks"}),e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition",children:[e.jsx(O,{size:16})," New Task"]})]}),w?e.jsxs("div",{className:"flex items-center justify-center py-6 text-gray-500",children:[e.jsx(S,{size:20,className:"animate-spin mr-2"}),"Loading tasks..."]}):!Array.isArray(g)||g.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-6",children:"No tasks added yet."}):e.jsx("div",{className:"space-y-3",children:e.jsx(R,{children:g.map(s=>{const i=s.status!=="completed"&&s.dueDate&&new Date(s.dueDate)<new Date;return e.jsxs(L.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`border rounded-lg p-4 flex justify-between items-start transition-all ${s.status==="completed"?"bg-green-50 border-green-300":i?"bg-red-50 border-red-300":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("h3",{className:`font-medium ${s.status==="completed"?"line-through text-gray-500":"text-gray-800"}`,children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-gray-500",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full font-medium ${s.priority==="urgent"?"bg-red-100 text-red-700":s.priority==="high"?"bg-orange-100 text-orange-700":s.priority==="medium"?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:s.priority?.toUpperCase()}),s.dueDate&&e.jsxs("span",{className:"flex items-center gap-1 bg-blue-50 px-2 py-0.5 rounded-full text-blue-700",children:[e.jsx(A,{size:12})," ",new Date(s.dueDate).toLocaleDateString()]}),i&&e.jsxs("span",{className:"flex items-center gap-1 bg-red-100 px-2 py-0.5 rounded-full text-red-700",children:[e.jsx(F,{size:12})," Overdue"]})]}),Array.isArray(s.assignedTo)&&s.assignedTo.length>0&&e.jsxs("p",{className:"text-xs text-gray-600 mt-2 flex items-center gap-1",children:[e.jsx(z,{size:12}),s.assignedTo.map(p=>p.name?p.name:"User").join(", ")]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[s.status!=="completed"&&e.jsxs("button",{onClick:()=>d(s),className:"text-sm flex items-center gap-1 text-green-700 hover:text-green-800",children:[e.jsx(P,{size:16}),"Mark Done"]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{onClick:()=>l(s),className:"text-blue-600 hover:text-blue-800",title:"Edit task",children:e.jsx(G,{size:18})}),e.jsx("button",{onClick:()=>x(s._id),className:"text-red-600 hover:text-red-800",title:"Delete task",children:e.jsx(q,{size:18})})]})]})]},s._id)})})}),e.jsx(E,{isOpen:v,onClose:()=>a(!1),existingTask:N,caseId:r,onSuccess:t})]})}function K({clientId:r}){const[g,m]=o.useState([]),[w,j]=o.useState(!0),N=o.useCallback(async()=>{if(r)try{j(!0);const{data:a}=await D.get(`/tasks?clientId=${r}`);m(Array.isArray(a)?a:[])}catch(a){console.error("âŒ Error fetching client tasks:",a),f.error("Failed to load client tasks")}finally{j(!1)}},[r]);o.useEffect(()=>{N();const a=d=>{(d?.client?._id===r||d?.client===r)&&(m(l=>[d,...l]),f.success(`ðŸ“‹ New task assigned: ${d.title}`))},t=d=>{(d?.client?._id===r||d?.client===r)&&(m(l=>l.map(u=>u._id===d._id?d:u)),f.info(`âœï¸ Task updated: ${d.title}`))},x=({_id:d})=>{m(l=>l.filter(u=>u._id!==d)),f.warning("ðŸ—‘ï¸ A task was removed")};return n.on("task:new",a),n.on("task:update",t),n.on("task:deleted",x),()=>{n.off("task:new",a),n.off("task:update",t),n.off("task:deleted",x)}},[r,N]);const h=a=>{const t="px-2 py-1 rounded-full text-xs font-medium capitalize inline-flex items-center gap-1";switch(a){case"completed":return`${t} bg-green-100 text-green-700`;case"in-progress":return`${t} bg-blue-100 text-blue-700`;case"pending":return`${t} bg-yellow-100 text-yellow-700`;case"overdue":return`${t} bg-red-100 text-red-700`;default:return`${t} bg-gray-100 text-gray-600`}},v=a=>a?new Date(a).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"â€”";return w?e.jsxs("div",{className:"flex justify-center items-center py-10 text-gray-500",children:[e.jsx(S,{className:"w-5 h-5 animate-spin mr-2"}),"Loading client tasks..."]}):g.length?e.jsx("div",{className:"space-y-3",children:g.map(a=>{const t=a.status!=="completed"&&a.dueDate&&new Date(a.dueDate)<new Date;return e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 bg-white shadow-sm hover:shadow-md hover:border-blue-300 transition-all duration-200",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm sm:text-base",children:a.title}),a.description&&e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:a.description})]}),e.jsxs("span",{className:h(a.status),children:[a.status,a.status==="completed"&&e.jsx(H,{className:"w-3 h-3"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:[e.jsx(A,{className:"inline w-3 h-3 mr-1"}),"Due: ",v(a.dueDate)]}),e.jsxs("span",{children:["Priority: ",a.priority||"medium"]}),e.jsxs("span",{children:["Assigned To:"," ",Array.isArray(a.assignedTo)?a.assignedTo.map(x=>x.name||"User").join(", "):a.assignedTo?.name||"Unassigned"]})]}),t&&e.jsxs("div",{className:"mt-2 text-xs flex items-center text-red-600",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Overdue"]})]},a._id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-gray-500",children:[e.jsx(U,{className:"w-8 h-8 mb-2 opacity-70"}),e.jsx("p",{children:"No tasks yet for this client."})]})}function $({clientId:r}){const[g,m]=o.useState([]),[w,j]=o.useState(!0),N=o.useCallback(async()=>{if(r)try{j(!0);const{data:t}=await D.get(`/tasks?clientId=${r}`);m(Array.isArray(t)?t:[])}catch(t){console.error("âŒ Error fetching client tasks:",t),f.error("Failed to load client tasks")}finally{j(!1)}},[r]);o.useEffect(()=>{N();const t=l=>{(l?.client===r||l?.client?._id===r)&&(m(u=>[l,...u]),f.success(`ðŸ“‹ New task assigned: ${l.title}`))},x=l=>{(l?.client===r||l?.client?._id===r)&&(m(u=>u.map(s=>s._id===l._id?l:s)),f.info(`âœï¸ Task updated: ${l.title}`))},d=({_id:l})=>{m(u=>u.filter(s=>s._id!==l)),f.warning("ðŸ—‘ï¸ A task was removed")};return n.on("task:new",t),n.on("task:update",x),n.on("task:deleted",d),()=>{n.off("task:new",t),n.off("task:update",x),n.off("task:deleted",d)}},[r,N]);const h={pending:g.filter(t=>t.status==="pending"),"in-progress":g.filter(t=>t.status==="in-progress"),completed:g.filter(t=>t.status==="completed"),overdue:g.filter(t=>t.status!=="completed"&&t.dueDate&&new Date(t.dueDate)<new Date)},v=[{id:"pending",title:"ðŸ•’ Pending",color:"border-amber-300"},{id:"in-progress",title:"âš™ï¸ In Progress",color:"border-blue-300"},{id:"overdue",title:"â° Overdue",color:"border-red-300"},{id:"completed",title:"âœ… Completed",color:"border-green-300"}],a=({task:t})=>{const x=t.dueDate?new Date(t.dueDate).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"â€”",d=t.status!=="completed"&&t.dueDate&&new Date(t.dueDate)<new Date;return e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm border hover:shadow-md hover:border-blue-300 transition",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:t.title}),t.description&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2",children:t.description}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:[e.jsx(A,{className:"inline w-3 h-3 mr-1"}),x]}),t.status==="completed"?e.jsx(P,{className:"w-4 h-4 text-green-600"}):d?e.jsx(M,{className:"w-4 h-4 text-red-500"}):e.jsx(A,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:[t.priority&&e.jsxs("span",{className:`px-2 py-0.5 rounded-full font-medium ${t.priority==="urgent"?"bg-red-100 text-red-700":t.priority==="high"?"bg-orange-100 text-orange-700":t.priority==="medium"?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:[t.priority.toUpperCase()," Priority"]}),Array.isArray(t.assignedTo)&&t.assignedTo.length>0&&e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(B,{size:12})," ",t.assignedTo.map(l=>l.name||"User").join(", ")]})]})]})};return w?e.jsxs("div",{className:"flex justify-center items-center py-10 text-gray-500",children:[e.jsx(S,{className:"w-5 h-5 animate-spin mr-2"}),"Loading tasks..."]}):g.length?e.jsx("div",{className:"grid md:grid-cols-4 gap-4",children:v.map(t=>e.jsxs("div",{className:`p-4 border rounded-lg bg-gray-50 ${t.color}`,children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:t.title}),e.jsx("div",{className:"space-y-3",children:h[t.id].length?h[t.id].map(x=>e.jsx(a,{task:x},x._id)):e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No tasks"})})]},t.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-gray-500",children:[e.jsx(F,{className:"w-8 h-8 mb-2 opacity-70"}),e.jsx("p",{children:"No tasks available for this client yet."})]})}function ie(){const[r,g]=o.useState("myTasks"),[m,w]=o.useState(!1),[j,N]=o.useState([]),[h,v]=o.useState(""),[a,t]=o.useState(null),[x,d]=o.useState(!0),l=o.useRef(!1),u=o.useCallback(async()=>{if(!l.current){l.current=!0;try{d(!0);const[i,p]=await Promise.all([D.get("/auth/me"),D.get("/clients")]),k=i?.data?.user??i?.data??i?.data?.data??null,C=p?.data?.data??p?.data??[];t(k),N(C)}catch(i){console.error("âŒ Error fetching user/clients:",i),f.error("Failed to load user or client data")}finally{d(!1)}}},[]);o.useEffect(()=>{u()},[u]),o.useEffect(()=>{const i=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");if(!i)return;_(i);const p=c=>f.success(`ðŸ†• New Task: ${c.title}`),k=c=>f(`âœï¸ Task Updated: ${c.title}`),C=c=>f.warning(`ðŸ—‘ï¸ Task Removed: ${c?.title??"a deleted task"}`);return n.on("task:new",p),n.on("task:update",k),n.on("task:deleted",C),()=>{n.off("task:new",p),n.off("task:update",k),n.off("task:deleted",C)}},[]);const s=[{id:"myTasks",label:"My Tasks",icon:e.jsx(U,{size:16})},{id:"clientTasks",label:"Client Tasks",icon:e.jsx(z,{size:16})},{id:"board",label:"Task Board",icon:e.jsx(W,{size:16})}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Task Management"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Track, assign, and complete legal tasks efficiently."})]}),e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition",children:[e.jsx(O,{size:16}),"New Task"]})]}),e.jsx("div",{className:"flex space-x-2 mb-6 border-b border-gray-200",children:s.map(i=>e.jsxs("button",{onClick:()=>g(i.id),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-t-md transition-all ${r===i.id?"bg-blue-100 text-blue-700 border-b-2 border-blue-600":"text-gray-600 hover:bg-gray-100"}`,children:[i.icon,i.label]},i.id))}),e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.25},className:"bg-white rounded-xl p-4 shadow-sm border",children:[r==="myTasks"&&e.jsx("div",{children:e.jsx(J,{})}),r==="clientTasks"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Select Client:"}),e.jsxs("select",{value:h,onChange:i=>v(i.target.value),className:"border border-gray-300 rounded-lg px-3 py-1.5 text-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Choose..."}),j.map(i=>e.jsx("option",{value:i._id,children:i.name},i._id))]})]}),h?e.jsxs(e.Fragment,{children:[e.jsx(K,{clientId:h}),e.jsx("div",{className:"mt-6",children:e.jsx($,{clientId:h})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic mt-4",children:"Select a client to view their tasks."})]}),r==="board"&&e.jsx("div",{children:!a&&!x?e.jsx("p",{className:"text-gray-500",children:"Cannot show board until user is loaded."}):e.jsx($,{clientId:a?._id||""})})]},r),e.jsx(E,{isOpen:m,onClose:()=>w(!1),onSuccess:()=>{f.success("âœ… Task saved successfully")}})]})}export{ie as default};
