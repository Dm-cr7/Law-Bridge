import{c as A,r as o,j as e,A as E,m as w,U as F}from"./index-f8gYbhCl.js";import{z as n}from"./index-BggV2thh.js";import{a as p}from"./api-BYptnXG6.js";import{C as _}from"./circle-x-BbSJhb8Y.js";import{C as M}from"./calendar-days-DTHvXfWa.js";import{C as P}from"./cloud-upload-DCES_0jE.js";/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],X=A("circle-plus",R);function G({isOpen:d,onClose:h,onSuccess:N,caseId:C,existingTask:s}){const f=o.useRef(),m=!!s,[D,k]=o.useState([]),[x,y]=o.useState(!1),[g,b]=o.useState(!1),[r,c]=o.useState({title:"",description:"",priority:"medium",dueDate:"",assignedTo:[],attachments:[]});o.useEffect(()=>{s&&c({title:s.title||"",description:s.description||"",priority:s.priority||"medium",dueDate:s.dueDate?s.dueDate.slice(0,10):"",assignedTo:s.assignedTo?.map(t=>t._id||t)||[],attachments:s.attachments||[]})},[s]),o.useEffect(()=>{d||c({title:"",description:"",priority:"medium",dueDate:"",assignedTo:[],attachments:[]})},[d]),o.useEffect(()=>{d&&(async()=>{try{const t=await p.get("/users");k(t.data||[])}catch(t){console.error("❌ Failed to fetch users:",t)}})()},[d]);const u=t=>{const{name:a,value:l}=t.target;c(i=>({...i,[a]:l}))},U=t=>{const a=Array.from(t.target.selectedOptions,l=>l.value);c(l=>({...l,assignedTo:a}))},T=async t=>{const a=Array.from(t.target.files||[]);if(!a.length)return;y(!0);const l=[];try{for(const i of a){const j=new FormData;j.append("file",i);const v=await p.post("/upload",j,{headers:{"Content-Type":"multipart/form-data"}});v.data?.url&&l.push(v.data.url)}c(i=>({...i,attachments:[...i.attachments||[],...l]})),n.success("Files uploaded successfully")}catch(i){console.error("❌ Upload error:",i),n.error("File upload failed")}finally{y(!1)}},S=async t=>{if(t.preventDefault(),!r.title.trim())return n.error("Task title is required");if(!r.dueDate)return n.error("Due date is required");if(!r.assignedTo?.length)return n.error("Select at least one assignee");try{b(!0);const a={...r,caseId:C};m?(await p.put(`/tasks/${s._id}`,a),n.success("Task updated successfully")):(await p.post("/tasks",a),n.success("Task created successfully")),N?.(),h()}catch(a){console.error("❌ Save error:",a),n.error("Failed to save task")}finally{b(!1)}},z=t=>{f.current&&!f.current.contains(t.target)&&h()};return e.jsx(E,{children:d&&e.jsx(w.div,{onMouseDown:z,className:"fixed inset-0 bg-black/40 z-50 flex items-center justify-center overflow-y-auto",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(w.div,{ref:f,className:"bg-white w-full max-w-lg rounded-xl shadow-lg relative my-10 overflow-hidden",initial:{y:50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},children:e.jsxs("div",{className:"max-h-[85vh] overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-white z-10 pb-2 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:m?"Edit Task":"Create Task"}),e.jsx("button",{onClick:h,className:"text-gray-500 hover:text-gray-700",children:e.jsx(_,{size:22})})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Title"}),e.jsx("input",{type:"text",name:"title",value:r.title,onChange:u,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1 focus:ring-2 focus:ring-blue-500",placeholder:"Enter task title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{name:"description",value:r.description,onChange:u,rows:3,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1 focus:ring-2 focus:ring-blue-500",placeholder:"Describe the task"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Priority"}),e.jsxs("select",{name:"priority",value:r.priority,onChange:u,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(M,{size:16})," Due Date"]}),e.jsx("input",{type:"date",name:"dueDate",value:r.dueDate,onChange:u,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(F,{size:16})," Assign To"]}),e.jsx("select",{name:"assignedTo",multiple:!0,value:r.assignedTo||[],onChange:U,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1 h-28",children:D.map(t=>e.jsxs("option",{value:t._id,children:[t.name," (",t.role,")"]},t._id))}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Hold ",e.jsx("kbd",{children:"Ctrl"})," or ",e.jsx("kbd",{children:"Cmd"})," to select multiple"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Attachments"}),e.jsxs("label",{className:"flex items-center justify-center gap-2 border-2 border-dashed border-gray-300 rounded-lg py-4 cursor-pointer hover:border-blue-400 text-gray-500 mt-1",children:[e.jsx(P,{size:18}),x?"Uploading...":"Click or drop files",e.jsx("input",{type:"file",multiple:!0,onChange:T,className:"hidden",disabled:x})]}),(r.attachments||[]).length>0&&e.jsx("ul",{className:"text-sm text-gray-600 mt-2 space-y-1",children:r.attachments.map((t,a)=>e.jsx("li",{className:"truncate",children:e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:t?.split("/").pop()||`Attachment ${a+1}`})},a))})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:g?m?"Updating...":"Creating...":m?"Update Task":"Create Task"})]})]})})})})}export{X as C,G as T};
