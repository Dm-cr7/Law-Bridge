import{c as k,b as z,r as i,j as e,A,m as f,U as B,s as _,X as $,F as L}from"./index-f8gYbhCl.js";import{z as h,n as U}from"./index-BggV2thh.js";import{a as w}from"./axiosInstance-CMvw4fUn.js";import{C as M}from"./circle-x-BbSJhb8Y.js";import{a as P}from"./axios-ArMxEAUb.js";import{C as q}from"./clock-CKoIW5G7.js";import{C as R}from"./cloud-upload-DCES_0jE.js";import{T as H}from"./trash-2-C5huwlW0.js";/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],O=k("activity",I);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],X=k("paperclip",W);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],se=k("share-2",G);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ae=k("square-pen",K);function re({caseData:t,onClose:d,onShared:b}){const{user:n,token:m}=z(),[u,x]=i.useState(""),[y,a]=i.useState([]),[l,j]=i.useState(t?.sharedWith?.map(s=>s._id)||[]),[S,r]=i.useState(!1),[c,p]=i.useState(!1),o=i.useRef(null),v=String(t?.filedBy?._id||t?.filedBy)===String(n?._id);i.useEffect(()=>{!v&&n.role!=="admin"&&(h.error("Only the case owner or admin can manage sharing."),d?.())},[v,n,d]);const N=async(s="")=>{try{r(!0);const C=((await w.get("/api/users",{headers:{Authorization:`Bearer ${m}`},params:s?{q:s}:{}})).data||[]).filter(E=>E._id!==n._id);a(C)}catch(g){console.error("âŒ Error fetching users:",g),h.error(g.response?.data?.message||"Failed to load users.")}finally{r(!1)}};i.useEffect(()=>{N()},[n,m]),i.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(()=>N(u),300),()=>clearTimeout(o.current)),[u]);const T=async()=>{try{p(!0);const s=await w.patch(`/api/cases/${t._id}/share`,{sharedWith:l},{headers:{Authorization:`Bearer ${m}`}});h.success("âœ… Case shared successfully."),b?.(s.data),d?.()}catch(s){console.error("âŒ Share case error:",s),h.error(s.response?.data?.message||"Failed to share case.")}finally{p(!1)}},F=s=>j(g=>g.includes(s)?g.filter(C=>C!==s):[...g,s]);return e.jsx(A,{children:t&&e.jsx(f.div,{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(f.div,{className:"bg-white w-full max-w-lg rounded-xl shadow-lg p-6 relative",initial:{y:40,opacity:0},animate:{y:0,opacity:1},exit:{y:40,opacity:0},children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600",onClick:d,title:"Close",children:e.jsx(M,{size:22})}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(B,{size:20}),"Share Case Access"]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Grant access to other registered users for:",e.jsx("br",{}),e.jsx("span",{className:"text-blue-600 font-medium",children:t.title})]}),e.jsx("input",{type:"text",placeholder:"Search users by name or email...",value:u,onChange:s=>x(s.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 mb-4 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"}),S?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Loading available users..."}):y.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No users found."}):e.jsx("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-lg divide-y divide-gray-100",children:y.map(s=>e.jsxs("label",{className:"flex items-center justify-between px-4 py-2 hover:bg-gray-50 cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-gray-800",children:s.name}),e.jsx("span",{className:"text-xs text-gray-500",children:s.email})]}),e.jsx("input",{type:"checkbox",checked:l.includes(s._id),onChange:()=>F(s._id),className:"accent-blue-600 w-4 h-4"})]},s._id))}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:d,className:"px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-800 text-sm font-medium",children:"Cancel"}),e.jsx("button",{onClick:T,disabled:c,className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium disabled:opacity-60",children:c?"Saving...":"Save Changes"})]})]})})})}function ie({caseData:t,onClose:d}){const{token:b}=z(),[n,m]=i.useState([]),[u,x]=i.useState(!0),y=async()=>{try{x(!0);const a=await P.get(`/cases/${t._id}/timeline`,{headers:{Authorization:`Bearer ${b}`}});m(a.data?.timeline||[])}catch(a){console.error("âŒ Timeline fetch failed:",a),U.error("Failed to load case timeline")}finally{x(!1)}};return i.useEffect(()=>{if(!t||!_)return;y();const a=l=>{l.caseId===t._id&&(m(j=>[l,...j]),U.success(`ðŸ”„ New case activity: ${l.action}`))};return _.on("case:activity",a),()=>_.off("case:activity",a)},[t]),t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs(f.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.25},className:"relative w-full max-w-2xl bg-white rounded-2xl shadow-xl p-6",children:[e.jsx("button",{onClick:d,className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700 transition","aria-label":"Close",children:e.jsx($,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(q,{className:"text-blue-600",size:20}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Case Timeline â€” ",e.jsx("span",{className:"text-blue-700",children:t.title})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-3 mb-4 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",t.status||"Unknown"," Â |Â ",e.jsx("strong",{children:"Category:"})," ",t.category||"Uncategorized"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Filed By:"})," ",t.filedBy?.name||"Unknown"," Â |Â ",e.jsx("strong",{children:"Client:"})," ",t.clientName||"N/A"]})]}),e.jsx("div",{className:"max-h-[65vh] overflow-y-auto pr-2",children:u?e.jsx("div",{className:"text-center text-gray-500 py-6",children:"Loading timeline..."}):n.length===0?e.jsx("div",{className:"text-center text-gray-500 py-6",children:"No activity yet."}):e.jsx("ul",{className:"relative border-l border-gray-200 pl-5",children:n.map((a,l)=>e.jsxs(f.li,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:l*.05},className:"mb-5 relative",children:[e.jsx("span",{className:"absolute -left-[7px] top-1 w-3 h-3 rounded-full bg-blue-500"}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-800 font-medium",children:a.action||"Activity"}),a.details&&e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:a.details}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:new Date(a.timestamp).toLocaleString()})]}),e.jsx(O,{size:16,className:"text-gray-400 mt-1 flex-shrink-0"})]})]},a._id||l))})})]})}):null}function le({caseData:t,onClose:d,onUpdated:b}){const{token:n}=z(),[m,u]=i.useState(t?.evidence||[]),[x,y]=i.useState(!1),[a,l]=i.useState(0),j=async r=>{const c=r.target.files?.[0];if(!c)return;const p=new FormData;p.append("file",c);try{y(!0),l(0);const{data:o}=await w.post(`/api/cases/${t._id}/upload`,p,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"},onUploadProgress:v=>{const N=Math.round(v.loaded*100/v.total);l(N)}});u(o.evidence||[]),b?.(o),h.success("ðŸ“Ž Evidence uploaded successfully")}catch(o){console.error("âŒ Upload error:",o),h.error(o.response?.data?.message||"Failed to upload evidence")}finally{y(!1),l(0),r.target.value=null}},S=async r=>{if(window.confirm("Are you sure you want to delete this evidence?"))try{await w.delete(`/api/cases/${t._id}/evidence/${r}`,{headers:{Authorization:`Bearer ${n}`}}),u(c=>c.filter(p=>p._id!==r)),h.success("ðŸ—‘ï¸ Evidence deleted")}catch(c){console.error("âŒ Delete error:",c),h.error(c.response?.data?.message||"Failed to delete file")}};return t?e.jsx(A,{children:e.jsx(f.div,{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(f.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},exit:{opacity:0,y:40},transition:{duration:.25},className:"relative bg-white w-full max-w-lg max-h-[90vh] overflow-y-auto rounded-2xl shadow-xl p-6",children:[e.jsx("button",{onClick:d,className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700 transition","aria-label":"Close modal",children:e.jsx($,{size:22})}),e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(X,{className:"text-emerald-600 w-5 h-5"}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Attach Evidence â€”"," ",e.jsx("span",{className:"text-emerald-700",children:t.title})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:`flex items-center justify-center gap-2 px-4 py-2 rounded-lg cursor-pointer font-medium text-white transition ${x?"bg-gray-400 cursor-not-allowed":"bg-emerald-500 hover:bg-emerald-600"}`,children:[e.jsx(R,{size:18}),x?"Uploading...":"Upload File",e.jsx("input",{type:"file",onChange:j,className:"hidden",disabled:x})]}),x&&e.jsx("div",{className:"mt-3 w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-500 h-2 rounded-full transition-all duration-300",style:{width:`${a}%`}})})]}),e.jsx("div",{className:"max-h-[55vh] overflow-y-auto",children:m.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No evidence uploaded yet."}):e.jsx("ul",{className:"divide-y divide-gray-100",children:m.map(r=>e.jsxs("li",{className:"py-3 flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx(L,{size:18,className:"text-gray-500 flex-shrink-0"}),e.jsx("a",{href:r.fileUrl||r.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline truncate max-w-[240px]",children:r.name||r.originalName||"Unnamed Document"})]}),e.jsx("button",{onClick:()=>S(r._id),className:"text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition","aria-label":"Delete file",children:e.jsx(H,{size:18})})]},r._id||r.fileKey))})})]})})}):null}export{le as A,ie as C,ae as S,se as a,re as b};
