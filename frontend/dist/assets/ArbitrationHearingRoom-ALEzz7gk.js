import{j as e,o as $,r as a,l as R,e as L,B as y,c as M,p as C}from"./index-DX-5XR_r.js";import{C as u,a as p,b,c as j}from"./Card-BJc8c6SY.js";import{I as F}from"./Input-BOJvGKkg.js";import{B as w}from"./Badge-DdmFeyrG.js";import{P as c}from"./index-B6SWdEHo.js";import{n as f}from"./index-DFuZcw6R.js";import{C as z,S as D}from"./send-DZAE-76Y.js";import{C as O}from"./circle-play-BYE3P59e.js";const E=({children:n,className:d="",maxHeight:m="70vh",fadeTop:i=!1,fadeBottom:h=!1})=>e.jsxs("div",{className:"relative w-full",children:[i&&e.jsx("div",{className:"pointer-events-none absolute top-0 left-0 right-0 h-6 bg-gradient-to-b from-background to-transparent z-10"}),e.jsx("div",{className:`
          relative overflow-y-auto scrollbar-thin scrollbar-thumb-rounded-md
          scrollbar-thumb-black-400 hover:scrollbar-thumb-black-500
          dark:scrollbar-thumb-black-600 dark:hover:scrollbar-thumb-black-500
          ${d}
        `,style:{maxHeight:m},children:n}),h&&e.jsx("div",{className:"pointer-events-none absolute bottom-0 left-0 right-0 h-6 bg-gradient-to-t from-background to-transparent z-10"})]});E.propTypes={children:c.node.isRequired,className:c.string,maxHeight:c.string,fadeTop:c.bool,fadeBottom:c.bool};const A="/api",U="http://localhost:5000";function W(){const{id:n}=$(),[d,m]=a.useState(!0),[i,h]=a.useState(null),[x,v]=a.useState([]),[N,H]=a.useState([]),[o,k]=a.useState(""),[r,S]=a.useState(!1),[l,I]=a.useState(null),g=a.useRef(null);a.useEffect(()=>{(async()=>{try{const{data:t}=await C.get(`${A}/arbitrations/${n}`);h(t),H([t.claimant,t.respondent,t.arbitrator].filter(Boolean))}catch(t){console.error(t),f.error("Failed to load hearing info")}finally{m(!1)}})()},[n]),a.useEffect(()=>{try{const s=R(U,{query:{roomId:n},transports:["websocket"]});return s.on("connect",()=>{console.log("✅ Connected to hearing socket")}),s.on("chatMessage",t=>{v(B=>[...B,t])}),s.on("hearingStatus",t=>{S(t==="active")}),s.on("disconnect",()=>{console.log("⚠️ Disconnected from hearing socket")}),I(s),()=>s.disconnect()}catch(s){console.warn("Socket.io not available:",s.message)}},[n]),a.useEffect(()=>{g.current&&g.current.scrollIntoView({behavior:"smooth"})},[x]);const P=()=>{if(!o.trim())return;const s={text:o,sender:"You",timestamp:new Date().toISOString()};v(t=>[...t,s]),l&&l.emit("chatMessage",s),k("")},T=async()=>{try{const s=r?"ended":"active";await C.patch(`${A}/arbitrations/${n}/hearing`,{status:s}),S(!r),l&&l.emit("hearingStatus",s),f.success(`Hearing ${r?"ended":"started"}`)}catch(s){console.error(s),f.error("Failed to update hearing status")}};return d?e.jsxs("div",{className:"flex h-80 items-center justify-center",children:[e.jsx(L,{className:"animate-spin mr-2"}),e.jsx("span",{children:"Loading hearing room..."})]}):i?e.jsxs("div",{className:"container mx-auto py-6 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(u,{className:"lg:col-span-1",children:[e.jsx(p,{children:e.jsx(b,{children:"Case Info"})}),e.jsxs(j,{className:"space-y-3 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Title:"})," ",i.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(w,{variant:r?"success":"secondary",className:"capitalize",children:r?"In Session":"Not Active"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Arbitrator:"})," ",i.arbitrator?.name||"Unassigned"]}),e.jsx("div",{className:"flex gap-2 mt-4",children:e.jsx(y,{onClick:T,variant:r?"destructive":"default",className:"flex items-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4"})," End Hearing"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4"})," Start Hearing"]})})})]})]}),e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(b,{children:"Participants"})}),e.jsx(j,{children:N.length===0?e.jsx("p",{className:"text-black-500 text-sm",children:"No participants found."}):e.jsx("ul",{className:"divide-y divide-black-200",children:N.map(s=>e.jsxs("li",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-black-500"}),e.jsx("span",{children:s.name})]}),e.jsx(w,{variant:"outline",children:s.role||"Party"})]},s._id))})})]}),e.jsxs(u,{className:"lg:col-span-2",children:[e.jsx(p,{children:e.jsx(b,{children:"Hearing Chat"})}),e.jsxs(j,{children:[e.jsxs(E,{className:"h-64 border p-2 rounded-md mb-3",children:[x.length===0?e.jsx("p",{className:"text-black-500 text-sm",children:"No messages yet."}):x.map((s,t)=>e.jsxs("div",{className:`mb-2 ${s.sender==="You"?"text-right text-blue-600":"text-left text-black-800"}`,children:[e.jsx("span",{className:"block text-xs text-black-400",children:new Date(s.timestamp).toLocaleTimeString()}),e.jsxs("span",{className:"inline-block bg-black-100 rounded-lg px-3 py-1",children:[e.jsxs("strong",{children:[s.sender,": "]}),s.text]})]},t)),e.jsx("div",{ref:g})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{value:o,onChange:s=>k(s.target.value),placeholder:"Type a message...",disabled:!r}),e.jsx(y,{onClick:P,disabled:!r||!o,children:e.jsx(D,{className:"h-4 w-4"})})]})]})]})]}):e.jsx("div",{className:"text-center text-black-500 mt-10",children:"⚠️ Arbitration not found."})}export{W as default};
