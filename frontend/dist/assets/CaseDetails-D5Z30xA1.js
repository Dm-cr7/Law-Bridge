import{b as $,r as a,j as e,A as q,m as U,d as z,o as W,u as H,F as O,U as K}from"./index-DX-5XR_r.js";import{z as l}from"./index-DFuZcw6R.js";import{a as k}from"./axiosInstance-QS7N9QFl.js";import{C as X}from"./circle-x-Dq1y862S.js";import{F as G}from"./folder-kanban-yQguAe-O.js";import{C as E}from"./circle-check-B3J-mFKz.js";import{S as J,A as Q,C as V}from"./AttachEvidenceModal-BseMBxcS.js";import{A as Y}from"./arrow-left-uQ4f0p4Z.js";import{S as Z,a as ee}from"./square-pen-W0nZhq9X.js";import{T as se}from"./trash-2-C-quUaQj.js";import{C as I}from"./cloud-upload-BqI6-c57.js";import{C as _}from"./clock-BQTrMZWA.js";import{M as te}from"./message-square-nLpgcwjS.js";function ae({isOpen:c,onClose:p,caseData:i,onUpdated:g}){const{user:t}=$(),[n,N]=a.useState({title:"",description:"",category:"civil",priority:"medium",status:"draft",clientId:"",respondentId:""}),[w,f]=a.useState([]),[C,y]=a.useState([]),[b,v]=a.useState(!1);a.useEffect(()=>{i&&N({title:i.title||"",description:i.description||"",category:i.category||"civil",priority:i.priority||"medium",status:i.status||"draft",clientId:i.clientId||"",respondentId:i.respondentId||""})},[i]),a.useEffect(()=>{if(!c)return;(async()=>{try{const x={Authorization:`Bearer ${localStorage.getItem("token")}`},[u,S]=await Promise.all([z.get("/users?role=client",{headers:x}),z.get("/users?role=respondent",{headers:x})]);f(u.data||[]),y(S.data||[])}catch(d){console.error("âŒ Failed to load parties",d),l.error("Failed to load clients/respondents")}})()},[c]);const o=r=>{const{name:d,value:x}=r.target;N(u=>({...u,[d]:x}))},h=async r=>{if(r.preventDefault(),!n.title.trim())return l.error("Case title is required");try{v(!0);const x={Authorization:`Bearer ${localStorage.getItem("token")}`},u=await z.put(`/cases/${i._id}`,n,{headers:x});l.success("âœ… Case updated successfully"),g?.(u.data),p()}catch(d){console.error("âŒ Update failed",d),l.error(d.response?.data?.message||"Failed to update case")}finally{v(!1)}};return e.jsx(q,{children:c&&e.jsx(U.div,{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(U.div,{className:"bg-white w-full max-w-lg rounded-2xl shadow-xl p-6 relative",initial:{y:50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600",onClick:p,children:e.jsx(X,{size:22})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Edit Case Details"}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Case Title"}),e.jsx("input",{type:"text",name:"title",value:n.title,onChange:o,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1 focus:ring-2 focus:ring-blue-500",placeholder:"Enter case title",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{name:"description",value:n.description,onChange:o,rows:4,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1 focus:ring-2 focus:ring-blue-500",placeholder:"Describe case progress or updates"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(G,{size:14})," Category"]}),e.jsxs("select",{name:"category",value:n.category,onChange:o,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1",children:[e.jsx("option",{value:"civil",children:"Civil"}),e.jsx("option",{value:"criminal",children:"Criminal"}),e.jsx("option",{value:"adr",children:"ADR"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Priority"}),e.jsxs("select",{name:"priority",value:n.priority,onChange:o,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Case Status"}),e.jsxs("select",{name:"status",value:n.status,onChange:o,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"filed",children:"Filed"}),e.jsx("option",{value:"under_review",children:"Under Review"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"hearing_in_progress",children:"Hearing in Progress"}),e.jsx("option",{value:"award_issued",children:"Award Issued"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Client"}),e.jsxs("select",{name:"clientId",value:n.clientId,onChange:o,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1",children:[e.jsx("option",{value:"",children:"Select client"}),w.map(r=>e.jsx("option",{value:r._id,children:r.name},r._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Respondent"}),e.jsxs("select",{name:"respondentId",value:n.respondentId,onChange:o,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1",children:[e.jsx("option",{value:"",children:"Select respondent"}),C.map(r=>e.jsx("option",{value:r._id,children:r.name},r._id))]})]})]}),e.jsx("button",{type:"submit",disabled:b,className:"w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition disabled:opacity-50 flex items-center justify-center gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"animate-spin",size:18}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{size:18}),"Save Changes"]})})]})]})})})}function je(){const{id:c}=W(),p=H(),{user:i,token:g}=$(),[t,n]=a.useState(null),[N,w]=a.useState(!0),[f,C]=a.useState(""),[y,b]=a.useState(!1),[v,o]=a.useState(0),[h,r]=a.useState(null),[d,x]=a.useState(!1),[u,S]=a.useState(!1),[B,A]=a.useState(!1),[P,F]=a.useState(!1),D=t?.filedBy?._id===i?._id,j=async()=>{try{w(!0);const{data:s}=await k.get(`/api/cases/${c}`,{headers:{Authorization:`Bearer ${g}`}});n(s)}catch(s){console.error("âŒ Fetch case error:",s),l.error("Failed to load case details")}finally{w(!1)}};a.useEffect(()=>{j()},[c]);const T=async()=>{if(!f.trim())return l.error("Note cannot be empty");try{await k.post(`/api/cases/${c}/note`,{content:f},{headers:{Authorization:`Bearer ${g}`}}),l.success("ðŸ“ Note added"),C(""),j()}catch(s){console.error("âŒ Add note error:",s),l.error("Failed to add note")}},M=async()=>{if(!h)return l.error("Select a file first");b(!0),o(0);try{const s=new FormData;s.append("file",h),await k.post(`/api/cases/${c}/upload`,s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${g}`},onUploadProgress:m=>{const L=Math.round(m.loaded*100/m.total);o(L)}}),l.success("ðŸ“ File uploaded successfully"),r(null),j()}catch(s){console.error("âŒ Upload error:",s),l.error("Upload failed")}finally{b(!1),o(0)}},R=async()=>{if(window.confirm("Are you sure you want to delete this case?"))try{await k.delete(`/api/cases/${c}`,{headers:{Authorization:`Bearer ${g}`}}),l.success("ðŸ—‘ï¸ Case deleted"),p("/cases")}catch(s){console.error("âŒ Delete error:",s),l.error("Failed to delete case")}};return N?e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-500",children:"Loading case details..."}):t?e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"cursor-pointer text-gray-600 hover:text-gray-800",onClick:()=>p("/cases")}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:t.title}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded-full capitalize",children:t.category})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[D&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"flex items-center gap-1 bg-blue-100 text-blue-700 px-3 py-1.5 rounded-lg hover:bg-blue-200 text-sm",onClick:()=>x(!0),children:[e.jsx(Z,{size:15})," Edit"]}),e.jsxs("button",{className:"flex items-center gap-1 bg-gray-100 text-gray-700 px-3 py-1.5 rounded-lg hover:bg-gray-200 text-sm",onClick:()=>S(!0),children:[e.jsx(ee,{size:15})," Share"]}),e.jsxs("button",{className:"flex items-center gap-1 bg-red-100 text-red-700 px-3 py-1.5 rounded-lg hover:bg-red-200 text-sm",onClick:R,children:[e.jsx(se,{size:15})," Delete"]})]}),e.jsxs("button",{className:"flex items-center gap-1 bg-emerald-100 text-emerald-700 px-3 py-1.5 rounded-lg hover:bg-emerald-200 text-sm",onClick:()=>A(!0),children:[e.jsx(I,{size:15})," Evidence"]}),e.jsxs("button",{className:"flex items-center gap-1 bg-indigo-100 text-indigo-700 px-3 py-1.5 rounded-lg hover:bg-indigo-200 text-sm",onClick:()=>F(!0),children:[e.jsx(_,{size:15})," Timeline"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-5 space-y-3",children:[e.jsx("h2",{className:"font-semibold text-gray-700 mb-2",children:"Case Overview"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status:"}),e.jsx("span",{className:"text-sm bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full",children:t.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Priority:"}),e.jsx("span",{className:`text-sm font-medium capitalize ${t.priority==="high"?"text-orange-600":t.priority==="urgent"?"text-red-600":"text-blue-600"}`,children:t.priority})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Filed By:"}),e.jsx("p",{className:"font-medium",children:t.filedBy?.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Client:"}),e.jsx("p",{className:"font-medium",children:t.client?.name||"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Respondent:"}),e.jsx("p",{className:"font-medium",children:t.respondent?.name||"â€”"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-5 flex flex-col",children:[e.jsxs("h2",{className:"font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(te,{size:18})," Notes"]}),e.jsx("div",{className:"flex-grow max-h-72 overflow-y-auto space-y-2 mb-3",children:t.notes?.length>0?t.notes.map((s,m)=>e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-2",children:[e.jsx("p",{className:"text-sm text-gray-700",children:s.content}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["â€” ",s.createdBy?.name||"Unknown",","," ",new Date(s.createdAt).toLocaleString()]})]},m)):e.jsx("p",{className:"text-gray-500 text-sm",children:"No notes yet."})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:f,onChange:s=>C(s.target.value),placeholder:"Write a note...",className:"w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-400"}),e.jsx("button",{onClick:T,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Add"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-5 space-y-3",children:[e.jsxs("h2",{className:"font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(O,{size:18})," Attachments"]}),e.jsxs("div",{className:"border border-dashed border-gray-300 rounded-lg p-4 text-center",children:[e.jsxs("label",{className:"cursor-pointer text-gray-600 hover:text-blue-600",children:[e.jsx(I,{size:18,className:"mx-auto mb-1"}),e.jsx("input",{type:"file",className:"hidden",onChange:s=>r(s.target.files[0])}),h?h.name:"Click to upload a document"]}),v>0&&y&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all",style:{width:`${v}%`}})}),h&&e.jsx("button",{onClick:M,disabled:y,className:"mt-2 bg-blue-600 text-white px-3 py-1.5 text-sm rounded-lg hover:bg-blue-700 disabled:opacity-50",children:y?"Uploading...":"Upload"})]}),e.jsx("ul",{className:"text-sm text-blue-600 space-y-1",children:t.attachments?.length>0?t.attachments.map((s,m)=>e.jsx("li",{children:e.jsx("a",{href:s.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"hover:underline",children:s.name})},m)):e.jsx("p",{className:"text-gray-500 text-sm",children:"No documents uploaded."})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mt-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-5",children:[e.jsxs("h2",{className:"font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(K,{size:18})," Shared With"]}),t.sharedWith?.length>0?e.jsx("ul",{className:"text-sm text-gray-700 space-y-1",children:t.sharedWith.map(s=>e.jsxs("li",{children:[s.name," ",e.jsxs("span",{className:"text-gray-500",children:["(",s.email,")"]})]},s._id))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No shared users."})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-5",children:[e.jsxs("h2",{className:"font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(_,{size:18})," Activity Log"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto text-sm text-gray-700 space-y-2",children:t.history?.length>0?t.history.slice().reverse().map((s,m)=>e.jsxs("div",{className:"border-b pb-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:s.action})," ",e.jsxs("span",{className:"text-gray-500",children:["â€” ",s.performedBy?.name||"Unknown"," at"," ",new Date(s.timestamp).toLocaleString()]})]}),s.note&&e.jsx("p",{className:"text-gray-600 text-xs",children:s.note})]},m)):e.jsx("p",{className:"text-gray-500 text-sm",children:"No activity yet."})})]})]}),d&&e.jsx(ae,{isOpen:d,onClose:()=>x(!1),caseData:t,onUpdated:j}),u&&e.jsx(J,{caseData:t,onClose:()=>S(!1),onShared:j}),B&&e.jsx(Q,{caseData:t,onClose:()=>A(!1),onUpdated:j}),P&&e.jsx(V,{caseData:t,onClose:()=>F(!1)})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-gray-600",children:[e.jsx("p",{children:"Case not found or access denied."}),e.jsx("button",{onClick:()=>p("/cases"),className:"mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Back to Cases"})]})}export{je as default};
