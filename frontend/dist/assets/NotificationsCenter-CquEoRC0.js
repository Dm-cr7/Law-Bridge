import{b as C,r as l,l as A,t as i,j as e,e as f,h as u,m as R,d as n}from"./index-DX-5XR_r.js";import{C as b}from"./circle-check-big-CsO3dtKP.js";import{T as S}from"./trash-2-C-quUaQj.js";import{C as z}from"./circle-x-Dq1y862S.js";function F(){const{user:d,token:c}=C(),[m,r]=l.useState([]),[h,p]=l.useState(!0),[o,x]=l.useState(!1),k=l.useRef(null);l.useEffect(()=>{if(!c||!d)return;const a=A("http://localhost:5000",{auth:{token:c},transports:["websocket"]});return k.current=a,a.on("connect",()=>{console.log("ðŸ”Œ Connected to Socket.IO for notifications")}),a.on("notification:new",s=>{i.message("ðŸ”” New Notification",{description:s.title||s.message}),r(v=>[s,...v]),g()}),a.on("disconnect",()=>{console.warn("âš ï¸ Disconnected from notification server")}),()=>{a.disconnect()}},[c,d]),l.useEffect(()=>{(async()=>{try{const{data:a}=await n.get("/notifications");r(a||[])}catch(a){console.error("Error loading notifications",a)}finally{p(!1)}})()},[]);const g=()=>{try{const t=new Audio("/sounds/notification.mp3");t.volume=.5,t.play().catch(()=>{})}catch{}},j=async t=>{try{await n.put(`/notifications/${t}/read`),r(a=>a.map(s=>s._id===t?{...s,read:!0}:s))}catch{i.error("Failed to mark as read")}},N=async t=>{try{await n.delete(`/notifications/${t}`),r(a=>a.filter(s=>s._id!==t))}catch{i.error("Failed to delete notification")}},y=async()=>{try{x(!0),await n.put("/notifications/mark-all-read"),r(t=>t.map(a=>({...a,read:!0}))),i.success("All notifications marked as read")}catch{i.error("Failed to mark all as read")}finally{x(!1)}},w=async()=>{if(window.confirm("Delete all notifications permanently?"))try{await n.delete("/notifications"),r([]),i.success("All notifications deleted")}catch{i.error("Failed to delete notifications")}};return h?e.jsxs("div",{className:"flex justify-center items-center h-[70vh] text-slate-600",children:[e.jsx(f,{className:"animate-spin mr-2"})," Loading notifications..."]}):e.jsx("div",{className:"notifications-page bg-black-50 dark:bg-black-900 min-h-screen py-10 px-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto bg-white dark:bg-black-800 shadow rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 dark:border-slate-700 pb-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400",children:e.jsx(u,{size:28})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:"Notifications Center"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"Stay updated with real-time system alerts"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:y,disabled:o,className:`flex items-center gap-1 px-4 py-2 rounded-md text-white ${o?"bg-slate-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:[o?e.jsx(f,{className:"animate-spin",size:16}):e.jsx(b,{size:16}),"Mark All Read"]}),e.jsxs("button",{onClick:w,className:"flex items-center gap-1 px-4 py-2 rounded-md bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(S,{size:16})," Clear All"]})]})]}),m.length===0?e.jsxs("div",{className:"text-center text-slate-500 dark:text-slate-400 py-10",children:[e.jsx(u,{className:"mx-auto mb-3 opacity-40",size:40}),"No notifications yet."]}):e.jsx("div",{className:"space-y-3",children:m.map((t,a)=>e.jsxs(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex items-start justify-between p-4 rounded-lg border ${t.read?"bg-black-100 dark:bg-black-800/60 border-transparent":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("h3",{className:"font-medium text-slate-900 dark:text-slate-100",children:t.title||"System Notification"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:t.message}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:new Date(t.createdAt).toLocaleString()})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[!t.read&&e.jsx("button",{onClick:()=>j(t._id),className:"text-green-600 hover:text-green-700",title:"Mark as read",children:e.jsx(b,{size:18})}),e.jsx("button",{onClick:()=>N(t._id),className:"text-red-500 hover:text-red-600",title:"Delete notification",children:e.jsx(z,{size:18})})]})]},t._id||a))})]})})}export{F as default};
