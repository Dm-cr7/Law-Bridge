import{c as ne,b as G,r as i,j as e,m as ie,F as le,U as oe,X as de,i as K,s as p}from"./index-f8gYbhCl.js";import{z as v,n as I}from"./index-BggV2thh.js";import{a as X}from"./axios-ArMxEAUb.js";import{N as ce}from"./NewCaseModal-BAp23sC2.js";import{S as me,a as pe,b as ue,C as xe,A as ge}from"./AttachEvidenceModal-B2RiBTAE.js";import{a as V}from"./axiosInstance-CMvw4fUn.js";import{F as he}from"./folder-kanban-1iVGXt7K.js";import{C as Y}from"./cloud-upload-DCES_0jE.js";import{C as fe}from"./check-kVNLxjHv.js";import{C as ye}from"./clock-CKoIW5G7.js";import{T as be}from"./trash-2-C5huwlW0.js";import{F as je}from"./file-down-04MLR8_x.js";import{P as Ce}from"./plus-BsD4batw.js";import"./circle-x-BbSJhb8Y.js";/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],we=ne("refresh-cw",ve);function ke({c:t,onUpdated:m,onDeleted:j,onShare:u,onAttach:F,onTimeline:g}){const{user:w,token:_}=G(),h=String(t?.filedBy?._id||t?.filedBy)===String(w?._id),[z,E]=i.useState(!1),[U,D]=i.useState(!1),[k,T]=i.useState(null),[y,R]=i.useState({title:t.title||"",description:t.description||"",status:t.status||"filed",priority:t.priority||"medium"});i.useEffect(()=>{R({title:t.title||"",description:t.description||"",status:t.status||"filed",priority:t.priority||"medium"})},[t]);const M=async()=>{if(!h&&w.role!=="admin"){v.error("Only the owner or admin can update this case.");return}try{const{data:r}=await V.patch(`/api/cases/${t._id}/status`,{status:y.status},{headers:{Authorization:`Bearer ${_}`}});m(r),E(!1),v.success("âœ… Case updated")}catch(r){console.error("âŒ Update error:",r),v.error(r.response?.data?.message||"Failed to update case")}},N=async()=>{if(!h&&w.role!=="admin")return v.error("Only the owner or admin can delete this case.");if(confirm("Are you sure you want to delete this case?"))try{await V.delete(`/api/cases/${t._id}`,{headers:{Authorization:`Bearer ${_}`}}),j(t._id),v.success("ðŸ—‘ï¸ Case deleted")}catch(r){console.error("âŒ Delete error:",r),v.error(r.response?.data?.message||"Failed to delete case")}},P=async()=>{if(!k)return v.error("Please select a file first.");D(!0);try{const r=new FormData;r.append("fileUrl",k),r.append("name",k.name),await V.post(`/api/cases/${t._id}/attachments`,r,{headers:{Authorization:`Bearer ${_}`,"Content-Type":"multipart/form-data"}}),v.success(`ðŸ“ ${k.name} uploaded`),T(null),m({...t})}catch(r){console.error("âŒ Upload error:",r),v.error(r.response?.data?.message||"Upload failed")}finally{D(!1)}},S={draft:"bg-gray-100 text-gray-700",filed:"bg-blue-100 text-blue-800",under_review:"bg-yellow-100 text-yellow-700",accepted:"bg-green-100 text-green-700",hearing_scheduled:"bg-indigo-100 text-indigo-700",hearing_in_progress:"bg-purple-100 text-purple-700",award_issued:"bg-teal-100 text-teal-700",resolved:"bg-emerald-100 text-emerald-700",closed:"bg-gray-200 text-gray-800",archived:"bg-red-100 text-red-700"}[y.status]||"bg-gray-100 text-gray-700",O={low:"bg-green-100 text-green-700",medium:"bg-blue-100 text-blue-700",high:"bg-orange-100 text-orange-700",urgent:"bg-red-100 text-red-700"}[y.priority]||"bg-blue-100 text-blue-700";return e.jsxs(ie.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.25},className:"bg-white dark:bg-gray-900 shadow-sm hover:shadow-md transition rounded-xl p-5 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[z?e.jsx("input",{type:"text",value:y.title,onChange:r=>R(b=>({...b,title:r.target.value})),className:"border-b border-blue-500 w-full text-lg font-semibold focus:outline-none bg-transparent"}):e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Filed by:"," ",e.jsxs("strong",{children:[t.filedBy?.name||"Unknown"," ",h&&e.jsx("span",{className:"text-blue-600",children:"(You)"})]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold capitalize ${S}`,children:y.status?.replace(/_/g," ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400 mb-2",children:[t.category&&e.jsxs(e.Fragment,{children:[e.jsx(he,{size:14,className:"text-gray-500"}),e.jsx("span",{children:t.category})]}),t.client&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsxs("span",{children:["Client: ",t.client?.name||"N/A"]})]})]}),z?e.jsx("textarea",{value:y.description,onChange:r=>R(b=>({...b,description:r.target.value})),rows:3,className:"w-full text-sm border rounded-md p-2 focus:ring-2 focus:ring-blue-400 bg-transparent"}):e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1 line-clamp-3",children:t.description||"No description provided."}),e.jsx("div",{className:"mt-3",children:e.jsxs("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-semibold ${O}`,children:["Priority: ",y.priority]})}),t.attachments?.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 flex items-center gap-1",children:[e.jsx(le,{size:14})," Documents:"]}),e.jsx("ul",{className:"ml-5 mt-1 list-disc text-sm text-blue-600 dark:text-blue-400",children:t.attachments.map((r,b)=>e.jsx("li",{children:e.jsx("a",{href:r.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"hover:underline",children:r.name})},b))})]}),h&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-gray-600 text-sm cursor-pointer",children:[e.jsx(Y,{size:16}),e.jsx("input",{type:"file",className:"hidden",id:`upload-${t._id}`,onChange:r=>T(r.target.files[0])}),e.jsx("span",{onClick:()=>document.getElementById(`upload-${t._id}`).click(),children:U?"Uploading...":"Upload File"})]}),k&&e.jsx("button",{onClick:P,disabled:U,className:"text-xs bg-blue-600 text-white px-3 py-1 rounded-lg mt-2 hover:bg-blue-700",children:U?"Uploading...":"Confirm Upload"})]}),t.sharedWith?.length>0&&e.jsxs("div",{className:"mt-3 text-xs text-gray-500 flex items-center gap-1 flex-wrap",children:[e.jsx(oe,{size:14})," Shared with:"," ",t.sharedWith.map((r,b)=>e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:[r.name,b<t.sharedWith.length-1&&", "]},r._id||b))]}),e.jsx("div",{className:"flex flex-wrap justify-end gap-2 mt-4 border-t pt-3",children:z?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"text-sm bg-gray-200 text-gray-800 px-3 py-1 rounded-lg",onClick:()=>E(!1),children:e.jsx(de,{size:14})}),e.jsx("button",{className:"text-sm bg-blue-600 text-white px-3 py-1 rounded-lg",onClick:M,children:e.jsx(fe,{size:14})})]}):e.jsxs(e.Fragment,{children:[h&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded-lg flex items-center gap-1",onClick:()=>E(!0),children:[e.jsx(me,{size:14})," Edit"]}),e.jsxs("button",{className:"text-sm bg-gray-100 text-gray-800 px-3 py-1 rounded-lg flex items-center gap-1",onClick:()=>u(t),children:[e.jsx(pe,{size:14})," Share"]})]}),e.jsxs("button",{className:"text-sm bg-emerald-100 text-emerald-700 px-3 py-1 rounded-lg flex items-center gap-1",onClick:()=>F(t),children:[e.jsx(Y,{size:14})," Attach"]}),e.jsxs("button",{className:"text-sm bg-indigo-100 text-indigo-700 px-3 py-1 rounded-lg flex items-center gap-1",onClick:()=>g(t),children:[e.jsx(ye,{size:14})," Timeline"]}),(h||w.role==="admin")&&e.jsxs("button",{className:"text-sm bg-red-100 text-red-700 px-3 py-1 rounded-lg flex items-center gap-1",onClick:N,children:[e.jsx(be,{size:14})," Delete"]})]})})]})}const _e=({variant:t="text",width:m="100%",height:j="1rem",count:u=1,className:F="",rounded:g="md"})=>{const w=Array.from({length:u}).map((_,h)=>e.jsx("div",{className:K("relative overflow-hidden bg-black-200 dark:bg-black-800 animate-pulse",{"rounded-full":t==="circle","rounded-md":t==="rect"||t==="text","rounded-2xl":t==="card"},F),style:{width:t==="circle"?j:typeof m=="number"?`${m}px`:m,height:typeof j=="number"?`${j}px`:j},children:e.jsx("div",{className:"absolute inset-0 -translate-x-full bg-gradient-to-r from-transparent via-white/40 to-transparent dark:via-black-700/40 animate-[shimmer_1.8s_infinite]"})},h));return e.jsx("div",{className:K("flex flex-col gap-2",t==="card"&&"p-4 border border-black-200 dark:border-black-700 rounded-2xl",F),children:w})};function Le(){const{user:t,token:m}=G(),[j,u]=i.useState([]),[F,g]=i.useState([]),[w,_]=i.useState(!0),[h,z]=i.useState(null),[E,U]=i.useState(!1),[D,k]=i.useState(null),[T,y]=i.useState(null),[R,M]=i.useState(null),[N,P]=i.useState(""),[S,O]=i.useState("All"),[r,b]=i.useState("All"),[C,J]=i.useState(1),[W]=i.useState(24),Q=i.useRef(0),L=i.useRef(null),A=i.useCallback(async({p:s=C,q:o=N,category:d=S,status:x=r}={})=>{if(m){_(!0),z(null);try{const f={page:s,limit:W};t?.role==="advocate"&&(f.mine=!0),d&&d!=="All"&&(f.category=d.toLowerCase()),x&&x!=="All"&&(f.status=x.toLowerCase()),o&&(f.q=o);const a=(await X.get("/cases",{headers:{Authorization:m?`Bearer ${m}`:void 0},params:f})).data||[];let l=[],n=0;Array.isArray(a)?(l=a,n=a.length):(l=a.items||a.data||[],n=a.total||l.length),Q.current=n,u(l),g(l),J(s)}catch(f){console.error("âŒ Fetch cases error:",f);const $=f?.response?.data?.message||"Error fetching cases.";z($),I.error($)}finally{_(!1)}}},[m,t,W,C,N,S,r]);i.useEffect(()=>(L.current&&clearTimeout(L.current),L.current=setTimeout(()=>{A({p:1,q:N,category:S,status:r})},300),()=>clearTimeout(L.current)),[N,S,r,A]),i.useEffect(()=>{if(!t||!m||!p)return;p.on("connect",()=>{try{p.emit("joinRoom",t._id?.toString())}catch{}}),A({p:1});const s=a=>{(a.filedBy?._id===t._id||(a.sharedWith||[]).some(n=>n._id===t._id)||t.role==="admin")&&(u(n=>[a,...n]),g(n=>[a,...n]),I.success(`ðŸ†• New case: ${a.title}`))},o=a=>{u(l=>l.map(n=>n._id===a._id?a:n)),g(l=>l.map(n=>n._id===a._id?a:n))},d=({caseId:a,status:l})=>{u(n=>n.map(B=>B._id===a?{...B,status:l}:B))},x=({caseId:a})=>{u(l=>l.filter(n=>n._id!==a)),g(l=>l.filter(n=>n._id!==a))},f=a=>{u(l=>[a,...l]),g(l=>[a,...l])},$=({caseId:a,sharedWith:l})=>{u(n=>n.map(B=>B._id===a?{...B,sharedWith:l}:B))};return p.on("case:new",s),p.on("case:update",o),p.on("case:statusUpdate",d),p.on("case:deleted",x),p.on("case:restored",f),p.on("case:shared",$),()=>{p.off("case:new",s),p.off("case:update",o),p.off("case:statusUpdate",d),p.off("case:deleted",x),p.off("case:restored",f),p.off("case:shared",$)}},[t,m,A]);const Z=s=>{u(o=>[s,...o]),g(o=>[s,...o])},H=s=>{u(o=>o.map(d=>d._id===s._id?s:d)),g(o=>o.map(d=>d._id===s._id?s:d))},ee=s=>{u(o=>o.filter(d=>d._id!==s)),g(o=>o.filter(d=>d._id!==s))},te=s=>{if(!(String(s.filedBy?._id||"")===String(t?._id||""))&&t.role!=="admin"){I.error("Only the case owner or an admin can share this case.");return}k(s)},se=async()=>{try{const s=await X.get("/reports/export?type=cases&format=csv",{headers:{Authorization:m?`Bearer ${m}`:void 0},responseType:"blob"}),o=new Blob([s.data],{type:"text/csv"}),d=window.URL.createObjectURL(o),x=document.createElement("a");x.href=d,x.download=`cases_${t?.name||"cases"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(x),x.click(),x.remove(),I.success("ðŸ“ Cases exported!")}catch(s){console.error("âŒ Export failed",s),I.error(s?.response?.data?.message||"Export failed")}},q=Math.max(1,Math.ceil((Q.current||j.length)/W)),re=()=>{C<q&&A({p:C+1})},ae=()=>{C>1&&A({p:C-1})};return e.jsxs("div",{style:c.page,children:[e.jsx(ce,{isOpen:E,onClose:()=>U(!1),onCreated:Z}),D&&e.jsx(ue,{caseData:D,onClose:()=>k(null),onShared:H}),T&&e.jsx(xe,{caseData:T,onClose:()=>y(null)}),R&&e.jsx(ge,{caseData:R,onClose:()=>M(null),onUpdated:H}),e.jsxs("header",{style:c.header,children:[e.jsxs("div",{children:[e.jsx("h1",{style:c.heading,children:"Case Management"}),e.jsx("p",{style:c.subtext,children:"Create, update, and manage cases. Realtime updates and role-based access."})]}),e.jsxs("div",{style:c.headerActions,children:[e.jsx("button",{style:c.iconBtn,onClick:()=>A({p:1}),title:"Refresh",children:e.jsx(we,{size:16})}),e.jsx("button",{style:c.iconBtn,onClick:se,title:"Export CSV",children:e.jsx(je,{size:16})}),e.jsxs("button",{style:c.newBtn,onClick:()=>U(!0),title:"Create new case",children:[e.jsx(Ce,{size:18,style:{marginRight:8}})," New Case"]})]})]}),e.jsxs("div",{style:c.filterBar,children:[e.jsx("input",{type:"text",placeholder:"Search by title...",value:N,onChange:s=>P(s.target.value),style:c.searchInput}),e.jsxs("select",{value:S,onChange:s=>O(s.target.value),style:c.select,children:[e.jsx("option",{children:"All"}),e.jsx("option",{value:"civil",children:"Civil"}),e.jsx("option",{value:"criminal",children:"Criminal"}),e.jsx("option",{value:"adr",children:"ADR"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("select",{value:r,onChange:s=>b(s.target.value),style:c.select,children:[e.jsx("option",{children:"All"}),e.jsx("option",{value:"filed",children:"Filed"}),e.jsx("option",{value:"under_review",children:"Under Review"}),e.jsx("option",{value:"hearing_scheduled",children:"Hearing Scheduled"}),e.jsx("option",{value:"hearing_in_progress",children:"Hearing (In Progress)"}),e.jsx("option",{value:"award_issued",children:"Award Issued"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),w?e.jsx(_e,{}):h?e.jsx("div",{style:c.errorBox,children:h}):j.length===0?e.jsx("div",{style:c.emptyBox,children:"No cases found."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:c.grid,children:F.map(s=>e.jsx(ke,{c:s,user:t,onShare:()=>te(s),onUpdated:H,onDeleted:ee,onTimeline:()=>y(s),onAttach:()=>M(s)},s._id))}),e.jsxs("div",{style:c.pagination,children:[e.jsxs("div",{children:["Page ",C," / ",q]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:ae,disabled:C<=1,style:c.pageBtn,children:"Prev"}),e.jsx("button",{onClick:re,disabled:C>=q,style:c.pageBtn,children:"Next"})]})]})]})]})}const c={page:{padding:"2rem",backgroundColor:"#f0f9ff",minHeight:"100vh",fontFamily:"Inter, sans-serif",color:"#0f172a"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},heading:{fontSize:"1.8rem",fontWeight:700},subtext:{fontSize:"0.9rem",color:"#475569"},headerActions:{display:"flex",gap:"0.75rem",alignItems:"center"},newBtn:{display:"flex",alignItems:"center",backgroundColor:"#3b82f6",color:"white",padding:"0.5rem 1rem",borderRadius:"8px",border:"none",cursor:"pointer"},iconBtn:{display:"inline-flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f1f5f9",color:"#0f172a",padding:"0.5rem",borderRadius:"8px",border:"none",cursor:"pointer"},filterBar:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",alignItems:"center"},searchInput:{flex:1,padding:"0.5rem 0.75rem",border:"1px solid #cbd5e1",borderRadius:"6px"},select:{padding:"0.5rem 0.75rem",border:"1px solid #cbd5e1",borderRadius:"6px",background:"white"},grid:{display:"grid",gap:"1.25rem",gridTemplateColumns:"repeat(auto-fill, minmax(340px, 1fr))"},emptyBox:{textAlign:"center",color:"#64748b",padding:"2rem",background:"#f8fafc",borderRadius:"8px"},errorBox:{color:"#b91c1c",textAlign:"center",padding:"1rem"},pagination:{marginTop:"1.25rem",display:"flex",justifyContent:"space-between",alignItems:"center"},pageBtn:{padding:"0.4rem 0.75rem",borderRadius:6,border:"1px solid #cbd5e1",background:"white",cursor:"pointer"}};export{Le as default};
