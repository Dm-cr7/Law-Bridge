import{b as T,r as i,l as D,j as e,C as E,F as L,U as P}from"./index-f8gYbhCl.js";import{_ as A}from"./style-QQ25Eq_G.js";import{u as F}from"./index.esm-CD2Rk9NM.js";import{a as R,o as M,s as h}from"./schemas-B-PNgsin.js";import{a as u}from"./api-BYptnXG6.js";import{t as n}from"./index-Cne2OvF7.js";import{P as U}from"./plus-BsD4batw.js";import"./index-Dgkh_OCz.js";const I="/socket.io",O="http://localhost:5000",$=M({name:h().min(2,"Name must be at least 2 characters"),email:h().email("Enter a valid email"),phone:h().optional().nullable(),notes:h().optional().nullable()});function W(){const{user:c}=T()||{},[N,p]=i.useState([]),[d,o]=i.useState([]),[x,g]=i.useState(!0),[K,f]=i.useState(null),[k,m]=i.useState(!1),{register:j,handleSubmit:y,reset:C,formState:{errors:r,isSubmitting:v}}=F({resolver:R($),defaultValues:{name:"",email:"",phone:"",notes:""}}),w=i.useCallback(async()=>{g(!0);try{const[s,a]=await Promise.all([u.get("/clients"),u.get("/tasks")]);p(Array.isArray(s.data)?s.data:[]),o(Array.isArray(a.data)?a.data:[])}catch(s){console.error("Paralegal dashboard load error:",s),n.error(s?.response?.data?.message||"Failed to load dashboard")}finally{g(!1)}},[]);i.useEffect(()=>{w()},[w]),i.useEffect(()=>{if(!c||!c._id)return;const s=D(O,{path:I,transports:["websocket"],withCredentials:!0,auth:{token:localStorage.getItem("token")},query:{userId:c._id,role:c.role}});return f(s),s.on("connect",()=>{console.info("Connected to real-time backend:",s.id)}),s.on("client:created",a=>{a&&(p(l=>l.some(t=>t._id===a._id)?l:[a,...l]),n.success(`New client: ${a.name}`))}),s.on("task:created",a=>{a&&(o(l=>[a,...l]),n.success(`Task assigned: ${a.title}`))}),s.on("task:updated",a=>{a&&o(l=>l.map(t=>t._id===a._id?a:t))}),s.on("task:deleted",({id:a})=>{o(l=>l.filter(t=>t._id!==a)),n.success("Task removed")}),s.on("notifications:new",a=>{n.info(a?.message||"New notification")}),s.on("disconnect",a=>{console.warn("Socket disconnected:",a)}),s.on("connect_error",a=>{console.error("Socket connect_error",a),n.error("Real-time connection error")}),()=>{s.removeAllListeners(),s.disconnect(),f(null)}},[c]);const b=i.useMemo(()=>{const s=d.filter(t=>(t.status||"").toLowerCase().includes("to do")||(t.status||"").toLowerCase()==="todo").length,a=d.filter(t=>(t.status||"").toLowerCase().includes("progress")).length,l=d.filter(t=>(t.status||"").toLowerCase().includes("complete")||(t.status||"").toLowerCase().includes("done")).length;return{todo:s,inProgress:a,done:l}},[d]),S=async s=>{try{const{data:a}=await u.post("/clients",s);p(l=>[a,...l]),n.success("Client created"),C(),m(!1)}catch(a){throw console.error("Create client failed:",a),n.error(a?.response?.data?.message||"Failed to create client"),a}},_=async s=>{try{const{data:a}=await u.put(`/tasks/${s}`,{status:"Completed"});o(l=>l.map(t=>t._id===s?a:t)),n.success("Task marked completed")}catch(a){console.error("Mark task done failed:",a),n.error("Failed to update task")}};return e.jsxs("div",{className:"jsx-1140322057 paralegal-dashboard min-h-screen p-6 bg-black-50",children:[k&&e.jsx("div",{className:"jsx-1140322057 fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"jsx-1140322057 bg-white rounded-lg shadow-lg w-full max-w-md p-6",children:[e.jsxs("div",{className:"jsx-1140322057 flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"jsx-1140322057 text-lg font-semibold",children:"Create New Client"}),e.jsx("button",{onClick:()=>m(!1),"aria-label":"Close",className:"jsx-1140322057 p-1 rounded hover:bg-black-100",children:e.jsx(X,{})})]}),e.jsxs("form",{onSubmit:y(S),noValidate:!0,className:"jsx-1140322057 space-y-4",children:[e.jsxs("div",{className:"jsx-1140322057",children:[e.jsx("label",{className:"jsx-1140322057 block text-sm font-medium",children:"Full name"}),e.jsx("input",{...j("name"),placeholder:"Jane Doe","aria-invalid":!!r.name,className:"jsx-1140322057 mt-1 w-full rounded-md border-black-200 shadow-sm p-2"}),r.name&&e.jsx("p",{className:"jsx-1140322057 text-xs text-red-600 mt-1",children:r.name.message})]}),e.jsxs("div",{className:"jsx-1140322057",children:[e.jsx("label",{className:"jsx-1140322057 block text-sm font-medium",children:"Email"}),e.jsx("input",{...j("email"),type:"email",placeholder:"client@example.com","aria-invalid":!!r.email,className:"jsx-1140322057 mt-1 w-full rounded-md border-black-200 shadow-sm p-2"}),r.email&&e.jsx("p",{className:"jsx-1140322057 text-xs text-red-600 mt-1",children:r.email.message})]}),e.jsxs("div",{className:"jsx-1140322057",children:[e.jsx("label",{className:"jsx-1140322057 block text-sm font-medium",children:"Phone"}),e.jsx("input",{...j("phone"),type:"tel",placeholder:"+2547...",className:"jsx-1140322057 mt-1 w-full rounded-md border-black-200 shadow-sm p-2"})]}),e.jsxs("div",{className:"jsx-1140322057",children:[e.jsx("label",{className:"jsx-1140322057 block text-sm font-medium",children:"Notes (optional)"}),e.jsx("textarea",{...j("notes"),rows:3,className:"jsx-1140322057 mt-1 w-full rounded-md border-black-200 shadow-sm p-2"})]}),e.jsxs("div",{className:"jsx-1140322057 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"jsx-1140322057 px-4 py-2 rounded-md bg-black-100",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:v,className:"jsx-1140322057 px-4 py-2 rounded-md bg-blue-600 text-white",children:v?"Creating...":"Create Client"})]})]})]})}),e.jsxs("header",{className:"jsx-1140322057 flex items-start justify-between mb-6 gap-4",children:[e.jsxs("div",{className:"jsx-1140322057",children:[e.jsx("h1",{className:"jsx-1140322057 text-3xl font-extrabold text-slate-900",children:"Paralegal Dashboard"}),e.jsx("p",{className:"jsx-1140322057 text-slate-600 mt-1",children:"Client intake, tasks, and document prep — live."})]}),e.jsx("div",{className:"jsx-1140322057 flex items-center gap-3",children:e.jsxs("button",{onClick:()=>m(!0),className:"jsx-1140322057 inline-flex items-center gap-2 px-4 py-2 rounded-md bg-blue-600 text-white",children:[e.jsx(U,{size:16})," New Client"]})})]}),e.jsxs("div",{className:"jsx-1140322057 grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"jsx-1140322057 bg-white p-4 rounded-lg shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"jsx-1140322057 p-2 bg-blue-50 rounded-md text-blue-600",children:e.jsx(E,{})}),e.jsxs("div",{className:"jsx-1140322057",children:[e.jsx("p",{className:"jsx-1140322057 text-sm text-slate-500",children:"To Do"}),e.jsx("p",{className:"jsx-1140322057 text-2xl font-bold",children:x?"—":b.todo})]})]}),e.jsxs("div",{className:"jsx-1140322057 bg-white p-4 rounded-lg shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"jsx-1140322057 p-2 bg-amber-50 rounded-md text-amber-600",children:e.jsx(L,{})}),e.jsxs("div",{className:"jsx-1140322057",children:[e.jsx("p",{className:"jsx-1140322057 text-sm text-slate-500",children:"In Progress"}),e.jsx("p",{className:"jsx-1140322057 text-2xl font-bold",children:x?"—":b.inProgress})]})]}),e.jsxs("div",{className:"jsx-1140322057 bg-white p-4 rounded-lg shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"jsx-1140322057 p-2 bg-green-50 rounded-md text-green-600",children:e.jsx(P,{})}),e.jsxs("div",{className:"jsx-1140322057",children:[e.jsx("p",{className:"jsx-1140322057 text-sm text-slate-500",children:"Completed"}),e.jsx("p",{className:"jsx-1140322057 text-2xl font-bold",children:x?"—":b.done})]})]})]}),e.jsxs("div",{className:"jsx-1140322057 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"jsx-1140322057 lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"jsx-1140322057 bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"jsx-1140322057 flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"jsx-1140322057 text-lg font-semibold",children:"All Tasks"}),e.jsx("div",{className:"jsx-1140322057 text-sm text-slate-500",children:d.length})]}),e.jsx("div",{className:"jsx-1140322057",children:x?e.jsxs("div",{className:"jsx-1140322057 animate-pulse space-y-2",children:[e.jsx("div",{className:"jsx-1140322057 h-8 bg-black-200 rounded"}),e.jsx("div",{className:"jsx-1140322057 h-8 bg-black-200 rounded"}),e.jsx("div",{className:"jsx-1140322057 h-8 bg-black-200 rounded"})]}):d.length===0?e.jsx("div",{className:"jsx-1140322057 text-center text-slate-500",children:"No tasks assigned"}):e.jsx("ul",{className:"jsx-1140322057 space-y-2",children:d.map(s=>e.jsxs("li",{className:"jsx-1140322057 flex items-center justify-between p-3 rounded bg-slate-50",children:[e.jsxs("div",{className:"jsx-1140322057",children:[e.jsx("div",{className:"jsx-1140322057 font-medium",children:s.title}),e.jsx("div",{className:"jsx-1140322057 text-xs text-slate-500",children:s.description})]}),e.jsxs("div",{className:"jsx-1140322057 flex items-center gap-3",children:[e.jsx("div",{className:`jsx-1140322057 px-2 py-1 text-xs rounded ${(s.status||"").toLowerCase().includes("progress")?"bg-amber-100":(s.status||"").toLowerCase().includes("done")?"bg-green-100":"bg-slate-100"}`,children:s.status||"Open"}),e.jsx("button",{onClick:()=>_(s._id),className:"jsx-1140322057 px-3 py-1 rounded bg-white border hover:shadow",children:"Mark Done"})]})]},s._id))})})]}),e.jsxs("div",{className:"jsx-1140322057 bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"jsx-1140322057 flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"jsx-1140322057 text-lg font-semibold",children:"Documents & Evidence"}),e.jsx("div",{className:"jsx-1140322057 text-sm text-slate-500",children:"Manage uploads & templates"})]}),e.jsxs("div",{className:"jsx-1140322057 text-slate-600",children:[e.jsx("p",{className:"jsx-1140322057 mb-2",children:"This section links to the document vault, template automation, and evidence uploader. Use the Documents area to draft templates requested by advocates and attach to cases."}),e.jsxs("div",{className:"jsx-1140322057 flex gap-3",children:[e.jsx("button",{className:"jsx-1140322057 px-3 py-2 rounded bg-blue-50 text-blue-700",children:"Open Document Vault"}),e.jsx("button",{className:"jsx-1140322057 px-3 py-2 rounded bg-black-100",children:"Upload Evidence"})]})]})]})]}),e.jsxs("aside",{className:"jsx-1140322057 space-y-4",children:[e.jsxs("div",{className:"jsx-1140322057 bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"jsx-1140322057 flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"jsx-1140322057 font-semibold",children:"Clients"}),e.jsx("button",{onClick:()=>m(!0),className:"jsx-1140322057 text-sm text-blue-600",children:"+ New"})]}),e.jsx("div",{className:"jsx-1140322057",children:x?e.jsxs("div",{className:"jsx-1140322057 animate-pulse space-y-2",children:[e.jsx("div",{className:"jsx-1140322057 h-8 bg-black-200 rounded"}),e.jsx("div",{className:"jsx-1140322057 h-8 bg-black-200 rounded"})]}):N.length===0?e.jsx("div",{className:"jsx-1140322057 text-slate-500",children:"No clients yet"}):e.jsx("ul",{className:"jsx-1140322057 space-y-2 max-h-72 overflow-auto",children:N.map(s=>e.jsxs("li",{className:"jsx-1140322057 flex items-center justify-between p-2 rounded hover:bg-slate-50",children:[e.jsxs("div",{className:"jsx-1140322057",children:[e.jsx("div",{className:"jsx-1140322057 font-medium",children:s.name}),e.jsx("div",{className:"jsx-1140322057 text-xs text-slate-500",children:s.email})]}),e.jsx("div",{className:"jsx-1140322057 text-xs text-slate-500",children:s.phone||"-"})]},s._id))})})]}),e.jsxs("div",{className:"jsx-1140322057 bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"jsx-1140322057 flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"jsx-1140322057 font-semibold",children:"Notifications"}),e.jsx("div",{className:"jsx-1140322057 text-sm text-slate-500",children:"Real-time"})]}),e.jsx("div",{className:"jsx-1140322057 space-y-2 max-h-48 overflow-auto text-slate-700",children:e.jsx("p",{className:"jsx-1140322057 text-sm text-slate-500",children:"New notifications appear as they arrive."})})]})]})]}),e.jsx(A,{id:"1140322057",children:['.paralegal-dashboard.jsx-1140322057{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}']})]})}export{W as default};
