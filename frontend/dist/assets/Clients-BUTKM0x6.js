import{c as _,b as E,r as o,j as e,M as $,U as F,d as A,X as B}from"./index-f8gYbhCl.js";import{u as M}from"./index.esm-CD2Rk9NM.js";import{t as b}from"./index-Cne2OvF7.js";import{a as C}from"./axios-ArMxEAUb.js";import{P as D}from"./plus-BsD4batw.js";import{T as I}from"./trash-2-C5huwlW0.js";import"./index-Dgkh_OCz.js";/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],P=_("pencil",L);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],q=_("square-check-big",U);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],V=_("square",T);/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M22 19h-6",key:"vcuq98"}]],H=_("user-round-plus",R),f=({children:t,variant:a="primary",className:s="",...n})=>{const i={primary:"bg-blue-600 hover:bg-blue-700 text-white",secondary:"bg-black-200 hover:bg-black-300 text-black-800",danger:"bg-red-600 hover:bg-red-700 text-white"};return e.jsx("button",{className:`px-4 py-2 rounded-md text-sm font-medium transition ${i[a]} ${s}`,...n,children:t})},z=({isOpen:t,onClose:a,title:s,children:n})=>t?e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex justify-center items-center z-50 backdrop-blur-sm",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 relative animate-fadeIn",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-black-800",children:s}),e.jsx("button",{onClick:a,className:"p-2 rounded-full hover:bg-black-100 transition",children:e.jsx(B,{size:20})})]}),n]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; transform: scale(0.96); }
          to { opacity: 1; transform: scale(1); }
        }
        .animate-fadeIn { animation: fadeIn 0.2s ease-out; }
      `})]}):null,O=({isOpen:t,onClose:a,onCreated:s,token:n})=>{const{register:i,handleSubmit:c,reset:x,formState:{isSubmitting:h,errors:m}}=M(),j=async p=>{try{const d=await C.post("/clients",p,{headers:{Authorization:`Bearer ${n}`}}),{client:y,userCreated:N}=d.data;s(y),b.success(e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{size:16,className:"text-green-600"}),e.jsxs("span",{children:["Client ",e.jsx("strong",{children:y.name})," created successfully"]})]}),N&&e.jsx("p",{className:"text-xs text-black-700 mt-1",children:"A user account has also been created for this client."})]})),x(),a()}catch(d){console.error(d),b.error(d.response?.data?.message||"âŒ Failed to create client")}};return o.useEffect(()=>{t||x()},[t,x]),e.jsx(z,{isOpen:t,onClose:a,title:"Create New Client",children:e.jsxs("form",{onSubmit:c(j),className:"space-y-4",children:[e.jsx(k,{label:"Full Name",name:"name",register:i,error:m.name,required:!0}),e.jsx(k,{label:"Email",name:"email",type:"email",register:i,error:m.email,required:!0}),e.jsx(k,{label:"Phone",name:"phone",register:i}),e.jsxs("div",{className:"flex justify-end gap-2 border-t pt-4",children:[e.jsx(f,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(f,{type:"submit",disabled:h,children:h?"Creating...":"Create Client"})]})]})})},W=({isOpen:t,onClose:a,client:s,onUpdated:n,token:i})=>{const{register:c,handleSubmit:x,reset:h,formState:{isSubmitting:m}}=M({defaultValues:s});o.useEffect(()=>{s&&h(s)},[s,h]);const j=async p=>{try{const d=await C.put(`/clients/${s._id}`,p,{headers:{Authorization:`Bearer ${i}`}});n(d.data),b.success("âœ… Client updated successfully"),a()}catch(d){console.error(d),b.error("âŒ Failed to update client")}};return e.jsx(z,{isOpen:t&&!!s,onClose:a,title:"Edit Client",children:e.jsxs("form",{onSubmit:x(j),className:"space-y-4",children:[e.jsx(k,{label:"Full Name",name:"name",register:c}),e.jsx(k,{label:"Email",name:"email",type:"email",register:c}),e.jsx(k,{label:"Phone",name:"phone",register:c}),e.jsxs("div",{className:"flex justify-end gap-2 border-t pt-4",children:[e.jsx(f,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(f,{type:"submit",disabled:m,children:m?"Saving...":"Save Changes"})]})]})})},X=({isOpen:t,onClose:a,client:s,onDeleted:n,token:i})=>{const c=async()=>{try{await C.delete(`/clients/${s._id}`,{headers:{Authorization:`Bearer ${i}`}}),n(s._id),b.success("ðŸ—‘ï¸ Client deleted successfully"),a()}catch(x){console.error(x),b.error("âŒ Failed to delete client")}};return e.jsxs(z,{isOpen:t&&!!s,onClose:a,title:"Delete Client",children:[e.jsxs("p",{className:"text-sm text-black-700 mb-4",children:["Are you sure you want to delete"," ",e.jsx("strong",{children:s?.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end gap-2 border-t pt-4",children:[e.jsx(f,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(f,{variant:"danger",onClick:c,children:"Delete"})]})]})},G=({isOpen:t,onClose:a,client:s,token:n,onShared:i})=>{const[c,x]=o.useState([]),[h,m]=o.useState([]),[j,p]=o.useState(!1),[d,y]=o.useState(!1);o.useEffect(()=>{t&&n&&(p(!0),C.get("/users",{headers:{Authorization:`Bearer ${n}`}}).then(r=>{const g=r.data.filter(l=>l._id!==s?.createdBy?._id);x(g);const S=s?.sharedWith?.map(l=>l._id)||[];m(S)}).catch(()=>b.error("Failed to load users")).finally(()=>p(!1)))},[t,n,s]);const N=r=>{m(g=>g.includes(r)?g.filter(S=>S!==r):[...g,r])},v=async()=>{try{y(!0);const r=await C.patch(`/clients/${s._id}/share`,{userIds:h},{headers:{Authorization:`Bearer ${n}`}});b.success("ðŸ‘¥ Client shared successfully"),i?.(r.data),a()}catch(r){console.error(r),b.error("âŒ Failed to share client")}finally{y(!1)}};return t?e.jsxs(z,{isOpen:t,onClose:a,title:"Share Client Access",children:[e.jsxs("p",{className:"text-sm text-black-700 mb-2",children:["Select users to share access to ",e.jsx("strong",{children:s?.name}),":"]}),e.jsx("div",{className:"border rounded-md max-h-60 overflow-y-auto divide-y divide-black-100",children:j?e.jsx("div",{className:"flex justify-center py-6 text-black-500",children:e.jsx(A,{className:"animate-spin w-5 h-5"})}):c.length===0?e.jsx("p",{className:"text-sm text-black-500 text-center py-4",children:"No other users available."}):c.map(r=>e.jsxs("div",{onClick:()=>N(r._id),className:"flex items-center justify-between p-3 cursor-pointer hover:bg-black-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-black-800",children:r.name}),e.jsxs("p",{className:"text-xs text-black-500",children:[r.role," â€” ",r.email]})]}),h.includes(r._id)?e.jsx(q,{className:"text-blue-600",size:18}):e.jsx(V,{className:"text-black-400",size:18})]},r._id))}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t mt-4",children:[e.jsx(f,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(f,{onClick:v,disabled:d,children:d?"Sharing...":"Share"})]})]}):null},k=({label:t,name:a,register:s,type:n="text",error:i,required:c=!1})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-black-800",children:[t,c&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{...s(a,{required:c}),type:n,className:"mt-1 w-full border border-black-300 rounded-md p-2 text-black-900 focus:ring-2 focus:ring-blue-500 focus:outline-none"}),i&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:i.message})]});function te(){const{token:t}=E(),[a,s]=o.useState([]),[n,i]=o.useState(!0),[c,x]=o.useState(null),[h,m]=o.useState(!1),[j,p]=o.useState(null),[d,y]=o.useState(null),[N,v]=o.useState(null);o.useEffect(()=>{t&&(async()=>{try{const u=await C.get("/clients",{headers:{Authorization:`Bearer ${t}`}});s(u.data)}catch(u){console.error(u),b.error("âŒ Failed to load clients"),x(u.response?.data?.message||"Failed to load clients")}finally{i(!1)}})()},[t]);const r=l=>s(u=>[l,...u]),g=l=>s(u=>u.map(w=>w._id===l._id?l:w)),S=l=>s(u=>u.filter(w=>w._id!==l));return e.jsxs("div",{className:"p-6 bg-black-50 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-black-900",children:"Client Management"}),e.jsx("p",{className:"text-sm text-black-600",children:"Manage your firmâ€™s clients, linked user accounts, and access."})]}),e.jsxs(f,{onClick:()=>m(!0),children:[e.jsx(D,{size:16,className:"mr-2"})," New Client"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow border border-black-100 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-black-100 text-black-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Name"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Email"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Phone"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Actions"})]})}),e.jsx("tbody",{children:n?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-6 text-black-500",children:"Loading..."})}):c?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-6 text-red-500",children:c})}):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-6 text-black-500",children:"No clients found."})}):a.map(l=>e.jsxs("tr",{className:"border-t hover:bg-black-50 transition",children:[e.jsx("td",{className:"py-3 px-4",children:l.name}),e.jsxs("td",{className:"py-3 px-4 text-black-600 flex items-center gap-1",children:[e.jsx($,{size:14})," ",l.email]}),e.jsx("td",{className:"py-3 px-4 text-black-600",children:l.phone}),e.jsxs("td",{className:"py-3 px-4 text-right space-x-2",children:[e.jsxs("button",{onClick:()=>v(l),className:"text-green-600 hover:underline inline-flex items-center gap-1",children:[e.jsx(F,{size:14})," Share"]}),e.jsxs("button",{onClick:()=>p(l),className:"text-blue-600 hover:underline inline-flex items-center gap-1",children:[e.jsx(P,{size:14})," Edit"]}),e.jsxs("button",{onClick:()=>y(l),className:"text-red-600 hover:underline inline-flex items-center gap-1",children:[e.jsx(I,{size:14})," Delete"]})]})]},l._id))})]})}),e.jsx(O,{isOpen:h,onClose:()=>m(!1),onCreated:r,token:t}),j&&e.jsx(W,{isOpen:!!j,client:j,onClose:()=>p(null),onUpdated:g,token:t}),d&&e.jsx(X,{isOpen:!!d,client:d,onClose:()=>y(null),onDeleted:S,token:t}),N&&e.jsx(G,{isOpen:!!N,client:N,onClose:()=>v(null),token:t,onShared:l=>{g(l),v(null)}})]})}export{te as default};
