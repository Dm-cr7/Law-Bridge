import{b as R,r as i,j as e,A as $,m as S,I as B,U as L}from"./index-f8gYbhCl.js";import{a as x}from"./axiosInstance-CMvw4fUn.js";import{z as n}from"./index-BggV2thh.js";import{C as M}from"./circle-x-BbSJhb8Y.js";import{F as q}from"./folder-kanban-1iVGXt7K.js";import{C as H}from"./cloud-upload-DCES_0jE.js";function Q({isOpen:p,onClose:U,onSuccess:I}){const{user:g,token:d}=R(),[r,m]=i.useState({title:"",description:"",clientId:"",respondentId:"",category:"civil",priority:"medium",attachments:[],sharedWith:[]}),[z,_]=i.useState([]),[A,k]=i.useState([]),[F,D]=i.useState([]),[f,b]=i.useState(!1),[y,u]=i.useState(0),[j,v]=i.useState(!1),[N,w]=i.useState(!1);i.useEffect(()=>!p||!d?void 0:(document.body.style.overflow="hidden",(async()=>{try{const s={Authorization:`Bearer ${d}`},[a,c]=await Promise.all([x.get("/api/users?role=client",{headers:s}),x.get("/api/users",{headers:s})]);_(a.data||[]),k(a.data||[]);const h=(c.data||[]).filter(l=>l._id!==g._id);D(h)}catch(s){console.error("âŒ Error loading users:",s),n.error(s.response?.data?.message||"Failed to load users")}})(),()=>{document.body.style.overflow="auto"}),[p,d,g]);const o=t=>{const{name:s,value:a}=t.target;m(c=>({...c,[s]:a}))},P=async t=>{const s=Array.from(t.target.files);if(s.length){b(!0),u(0);try{const a=new FormData;s.forEach(l=>a.append("files",l));const{data:c}=await x.post("/api/upload/multiple",a,{headers:{Authorization:`Bearer ${d}`,"Content-Type":"multipart/form-data"},onUploadProgress:l=>u(Math.round(l.loaded*100/l.total))}),h=c?.files?.map(l=>({name:l.name,fileUrl:l.fileUrl}))||[];m(l=>({...l,attachments:[...l.attachments,...h]})),n.success(`${h.length} file(s) uploaded successfully`)}catch(a){console.error("âŒ Upload failed:",a),n.error(a.response?.data?.message||"Upload failed")}finally{b(!1),u(0)}}},W=t=>{m(s=>({...s,sharedWith:s.sharedWith.includes(t)?s.sharedWith.filter(a=>a!==t):[...s.sharedWith,t]}))},E=async t=>{if(t.preventDefault(),!r.title.trim())return n.error("Case title is required");if(!r.clientId)return n.error("Please select a client");try{v(!0);const s={...r,filedBy:g._id},{data:a}=await x.post("/api/cases",s,{headers:{Authorization:`Bearer ${d}`}});n.success("âœ… Case filed successfully"),I?.(a),C()}catch(s){console.error("âŒ Create case error:",s),n.error(s.response?.data?.message||"Failed to create case")}finally{v(!1)}},C=()=>{m({title:"",description:"",clientId:"",respondentId:"",category:"civil",priority:"medium",attachments:[],sharedWith:[]}),u(0),w(!1),U()};return e.jsx($,{children:p&&e.jsx(S.div,{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(S.div,{className:"bg-white w-full max-w-md max-h-[90vh] overflow-y-auto rounded-2xl shadow-xl p-5 relative",initial:{y:50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600",onClick:C,children:e.jsx(M,{size:22})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"ðŸ§¾ File New Case"}),e.jsxs("form",{onSubmit:E,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Case Title"}),e.jsx("input",{type:"text",name:"title",value:r.title,onChange:o,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1 text-sm focus:ring-2 focus:ring-blue-500",placeholder:"Enter case title",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(q,{size:14})," Category"]}),e.jsxs("select",{name:"category",value:r.category,onChange:o,className:"w-full border border-gray-300 rounded-lg px-2 py-2 mt-1 text-sm",children:[e.jsx("option",{value:"civil",children:"Civil"}),e.jsx("option",{value:"criminal",children:"Criminal"}),e.jsx("option",{value:"adr",children:"ADR"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Priority"}),e.jsxs("select",{name:"priority",value:r.priority,onChange:o,className:"w-full border border-gray-300 rounded-lg px-2 py-2 mt-1 text-sm",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Client"}),e.jsxs("select",{name:"clientId",value:r.clientId,onChange:o,className:"w-full border border-gray-300 rounded-lg px-2 py-2 mt-1 text-sm",children:[e.jsx("option",{value:"",children:"Select client"}),z.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:["Respondent",e.jsx(B,{size:12,className:"text-gray-400",title:"Opposing party or defendant"})]}),e.jsxs("select",{name:"respondentId",value:r.respondentId,onChange:o,className:"w-full border border-gray-300 rounded-lg px-2 py-2 mt-1 text-sm",children:[e.jsx("option",{value:"",children:"Select respondent"}),A.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{name:"description",value:r.description,onChange:o,rows:3,className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1 text-sm focus:ring-2 focus:ring-blue-500",placeholder:"Brief summary of the case"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Attachments"}),e.jsxs("label",{className:"flex items-center justify-center gap-2 border-2 border-dashed border-gray-300 rounded-lg py-3 cursor-pointer hover:border-blue-400 text-gray-500 mt-1 text-sm",children:[e.jsx(H,{size:16}),f?`Uploading... ${y}%`:"Click or drop files",e.jsx("input",{type:"file",multiple:!0,onChange:P,className:"hidden",disabled:f})]}),y>0&&f&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${y}%`}})}),r.attachments?.length>0&&e.jsx("ul",{className:"text-sm text-gray-600 mt-1 space-y-1",children:r.attachments.map((t,s)=>e.jsx("li",{className:"truncate",children:e.jsx("a",{href:t.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:t.name})},s))})]}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>w(t=>!t),className:"flex items-center gap-2 text-sm text-blue-600 mt-2",children:[e.jsx(L,{size:15}),N?"Hide share list":"Share with others"]}),N&&e.jsx("div",{className:"max-h-32 overflow-y-auto border border-gray-200 rounded-lg mt-2",children:F.map(t=>e.jsxs("label",{className:"flex items-center justify-between px-3 py-2 hover:bg-gray-50 text-sm cursor-pointer border-b last:border-none",children:[e.jsx("span",{children:t.name}),e.jsx("input",{type:"checkbox",checked:r.sharedWith.includes(t._id),onChange:()=>W(t._id),className:"accent-blue-600 w-4 h-4"})]},t._id))})]}),e.jsx("button",{type:"submit",disabled:j,className:"w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition text-sm disabled:opacity-50",children:j?"Submitting...":"File Case"})]})]})})})}export{Q as N};
